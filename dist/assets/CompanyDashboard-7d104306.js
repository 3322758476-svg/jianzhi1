import{d as de,u as ue,B as N,r as k,o as ce,c as y,b as s,a as o,w as a,h as pe,E as g,i as p,k as _,n as m,l as v,a2 as me,W as _e,a5 as fe,a4 as ve,t as d,P as $,p as M,a6 as P,a7 as H,I as D,q as ge,x as ye,y as be,F as A,e as B,V as we,_ as ke}from"./index-d856f604.js";import{C as he}from"./CompanySidebar-2b3a57ff.js";import{c as h}from"./companyDataService-d2da87ef.js";const Ce={class:"company-layout"},Te={class:"company-main"},Ve={class:"company-header"},xe={class:"header-left"},Fe={class:"header-actions"},Je={class:"company-dashboard"},qe={class:"stats-cards"},Me={class:"stat-content"},De={class:"stat-icon"},Re={class:"stat-info"},Ee={class:"stat-value"},Se={class:"stat-content"},Ue={class:"stat-icon"},$e={class:"stat-info"},Ae={class:"stat-value"},Be={class:"stat-content"},ze={class:"stat-icon"},Ie={class:"stat-info"},Ne={class:"stat-value"},Pe={class:"stat-content"},He={class:"stat-icon"},Le={class:"stat-info"},Oe={class:"stat-value"},We={class:"rating-stars"},Ge={class:"section-header"},Ke={class:"applications-list"},Qe={key:0,class:"empty-state"},Xe={class:"application-info"},Ye={class:"student-info"},Ze={class:"student-details"},je={class:"student-name"},et={class:"student-school"},tt={class:"job-info"},st={class:"job-title"},ot={class:"apply-time"},lt={class:"application-actions"},at={class:"section-header"},nt={class:"jobs-list"},it={key:0,class:"empty-state"},rt={class:"job-info"},dt={class:"job-title"},ut={class:"job-meta"},ct={class:"salary"},pt={class:"location"},mt={class:"work-time"},_t={class:"job-stats"},ft={class:"job-actions"},vt=de({__name:"CompanyDashboard",setup(gt){const F=pe(),R=ue(),r=N({totalJobs:0,totalApplications:0,unreadMessages:0,avgRating:0,jobsTrend:0,applicationsTrend:0}),E=k([]),S=k([]),z=k(!1),L=()=>R.user?R.user.role!=="company"?(F.push("/"),!1):!!R.user.companyId:(F.push("/login"),!1),J=async()=>{try{if(z.value=!0,!L())return;const[t,e,T]=await Promise.all([h.getDashboardStats(),h.getCompanyJobs({page:1,pageSize:5}),h.getCompanyApplications({page:1,pageSize:5})]);r.totalJobs=t.totalJobs,r.totalApplications=t.totalApplications,r.unreadMessages=0,r.avgRating=4.5,S.value=e.jobs.map(i=>({id:i.id,title:i.title,salary:i.salary_range,location:i.work_location,workTime:i.work_hours,recruitCount:i.recruit_count,applicationCount:0,publishTime:i.created_at,description:i.description,tags:i.skills_required||[]})),E.value=T.applications.map(i=>{var u,c,f,q,V;return{id:i.id,student:{name:((u=i.profiles)==null?void 0:u.name)||"未知用户",avatar:((c=i.profiles)==null?void 0:c.avatar_url)||"",school:((f=i.profiles)==null?void 0:f.university)||"未知学校",major:((q=i.profiles)==null?void 0:q.major)||"未知专业"},job:{title:((V=i.jobs)==null?void 0:V.title)||"未知岗位"},status:i.status,applyTime:O(i.applied_at)}})}catch(t){console.error("加载仪表盘数据失败:",t),g.error("加载仪表盘数据失败: "+t.message)}finally{z.value=!1}},O=t=>{const e=new Date(t),i=new Date().getTime()-e.getTime(),u=Math.floor(i/6e4),c=Math.floor(i/36e5),f=Math.floor(i/864e5);return u<60?`${u}分钟前`:c<24?`${c}小时前`:`${f}天前`},C=k(!1),b=k(null),U=k(),n=N({title:"",salary:"",location:"",workTime:"",recruitCount:1,description:"",tags:[]}),W={title:[{required:!0,message:"请输入岗位标题",trigger:"blur"}],salary:[{required:!0,message:"请输入薪资范围",trigger:"blur"}],location:[{required:!0,message:"请输入工作地点",trigger:"blur"}],workTime:[{required:!0,message:"请输入工作时间",trigger:"blur"}],description:[{required:!0,message:"请输入岗位描述",trigger:"blur"}]},G=["前端开发","后端开发","移动端","UI设计","产品经理","运营","市场","销售","客服","行政","财务","React","Vue","Angular","Node.js","Python","Java"],I=(t=null)=>{console.log("showJobForm被调用，参数类型:",typeof t),console.log("showJobForm参数详情:",t),t&&typeof t=="object"&&!(t instanceof PointerEvent)?(console.log("编辑岗位 - job对象:",t),console.log("job.id:",t.id),console.log("job.title:",t.title),b.value=t,Object.assign(n,{title:t.title||"",salary:t.salary_range||"",location:t.work_location||"",workTime:t.work_hours||"",recruitCount:t.recruit_count||1,description:t.description||"",tags:t.skills_required||[]}),C.value=!0):(console.log("发布新岗位或参数无效，参数:",t),F.push("/company/jobs/new"))},K=async()=>{if(U.value)try{if(await U.value.validate(),b.value){if(!b.value.id||b.value.id==="undefined")throw new Error("岗位ID无效，无法更新岗位");await h.updateJob(b.value.id,{title:n.title,description:n.description,salary_range:n.salary,work_location:n.location,work_hours:n.workTime,recruit_count:n.recruitCount,skills_required:n.tags,category:"技术",job_type:"实习"}),g.success("岗位更新成功")}else await h.createJob({title:n.title,description:n.description,salary_range:n.salary,work_location:n.location,work_hours:n.workTime,recruit_count:n.recruitCount,skills_required:n.tags,category:"技术",job_type:"实习"}),g.success("岗位创建成功");C.value=!1,await J()}catch(t){console.error("操作岗位失败:",t),g.error("操作失败: "+t.message)}},Q=t=>{console.log("editJob被调用，参数类型:",typeof t),console.log("editJob参数详情:",t),console.log("job.id:",t==null?void 0:t.id),console.log("job.title:",t==null?void 0:t.title),t&&typeof t=="object"&&t.id?I(t):(console.error("无效的岗位对象:",t),g.error("无法编辑该岗位，数据异常"))},X=async t=>{try{await we.confirm("确定要删除这个岗位吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await h.updateJob(t.id,{status:"closed"}),g.success("岗位已关闭"),await J()}catch(e){e!=="cancel"&&(console.error("删除岗位失败:",e),g.error("删除失败: "+e.message))}},Y=t=>{F.push(`/company/applications/${t.id}`)},Z=t=>({pending:"warning",reviewing:"info",accepted:"success",rejected:"danger"})[t]||"info",j=t=>({pending:"待处理",reviewing:"审核中",accepted:"已通过",rejected:"已拒绝"})[t]||"未知",ee=async()=>{try{await J(),g.success("数据已刷新")}catch{g.error("刷新数据失败")}},te=()=>{const t=document.documentElement;document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()};return ce(()=>{J()}),(t,e)=>{const T=p("el-breadcrumb-item"),i=p("el-breadcrumb"),u=p("el-icon"),c=p("el-button"),f=p("el-card"),q=p("el-rate"),V=p("el-empty"),se=p("el-avatar"),oe=p("el-tag"),x=p("el-input"),w=p("el-form-item"),le=p("el-input-number"),ae=p("el-option"),ne=p("el-select"),ie=p("el-form"),re=p("el-dialog");return _(),y("div",Ce,[s(he),o("div",Te,[o("div",Ve,[o("div",xe,[e[15]||(e[15]=o("h1",null,"企业控制台",-1)),s(i,{separator:"/"},{default:a(()=>[s(T,{to:{path:"/company/dashboard"}},{default:a(()=>[...e[13]||(e[13]=[m("首页",-1)])]),_:1}),s(T,null,{default:a(()=>[...e[14]||(e[14]=[m("控制台",-1)])]),_:1})]),_:1})]),o("div",Fe,[s(c,{type:"primary",onClick:e[0]||(e[0]=()=>I("new"))},{default:a(()=>[s(u,null,{default:a(()=>[s(v(me))]),_:1}),e[16]||(e[16]=m(" 发布新岗位 ",-1))]),_:1}),s(c,{onClick:ee},{default:a(()=>[s(u,null,{default:a(()=>[s(v(_e))]),_:1}),e[17]||(e[17]=m(" 刷新 ",-1))]),_:1}),s(c,{onClick:te},{default:a(()=>[s(u,null,{default:a(()=>[s(v(fe))]),_:1}),e[18]||(e[18]=m(" 全屏 ",-1))]),_:1})])]),o("div",Je,[o("div",qe,[s(f,{class:"stat-card"},{default:a(()=>[o("div",Me,[o("div",De,[s(u,null,{default:a(()=>[s(v(ve))]),_:1})]),o("div",Re,[o("div",Ee,d(r.totalJobs),1),e[19]||(e[19]=o("div",{class:"stat-label"},"发布岗位",-1)),o("div",{class:$(["stat-trend",{positive:r.jobsTrend>0,negative:r.jobsTrend<0}])},[r.jobsTrend>0?(_(),M(u,{key:0},{default:a(()=>[s(v(P))]),_:1})):r.jobsTrend<0?(_(),M(u,{key:1},{default:a(()=>[s(v(H))]),_:1})):D("",!0),m(" "+d(Math.abs(r.jobsTrend))+"% ",1)],2)])])]),_:1}),s(f,{class:"stat-card"},{default:a(()=>[o("div",Se,[o("div",Ue,[s(u,null,{default:a(()=>[s(v(ge))]),_:1})]),o("div",$e,[o("div",Ae,d(r.totalApplications),1),e[20]||(e[20]=o("div",{class:"stat-label"},"收到申请",-1)),o("div",{class:$(["stat-trend",{positive:r.applicationsTrend>0,negative:r.applicationsTrend<0}])},[r.applicationsTrend>0?(_(),M(u,{key:0},{default:a(()=>[s(v(P))]),_:1})):r.applicationsTrend<0?(_(),M(u,{key:1},{default:a(()=>[s(v(H))]),_:1})):D("",!0),m(" "+d(Math.abs(r.applicationsTrend))+"% ",1)],2)])])]),_:1}),s(f,{class:"stat-card"},{default:a(()=>[o("div",Be,[o("div",ze,[s(u,null,{default:a(()=>[s(v(ye))]),_:1})]),o("div",Ie,[o("div",Ne,d(r.unreadMessages),1),e[21]||(e[21]=o("div",{class:"stat-label"},"未读消息",-1)),o("div",{class:$(["stat-badge",{urgent:r.unreadMessages>5,normal:r.unreadMessages<=5}])},d(r.unreadMessages>5?"需处理":"正常"),3)])])]),_:1}),s(f,{class:"stat-card"},{default:a(()=>[o("div",Pe,[o("div",He,[s(u,null,{default:a(()=>[s(v(be))]),_:1})]),o("div",Le,[o("div",Oe,d(r.avgRating),1),e[22]||(e[22]=o("div",{class:"stat-label"},"平均评分",-1)),o("div",We,[s(q,{modelValue:r.avgRating,"onUpdate:modelValue":e[1]||(e[1]=l=>r.avgRating=l),disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}"},null,8,["modelValue"])])])])]),_:1})]),s(f,{class:"recent-section"},{header:a(()=>[o("div",Ge,[e[24]||(e[24]=o("h3",null,"最近申请",-1)),s(c,{type:"text",onClick:e[2]||(e[2]=l=>t.$router.push("/company/applications"))},{default:a(()=>[...e[23]||(e[23]=[m(" 查看全部 ",-1)])]),_:1})])]),default:a(()=>[o("div",Ke,[E.value.length===0?(_(),y("div",Qe,[s(V,{description:"暂无申请记录"})])):D("",!0),(_(!0),y(A,null,B(E.value,l=>(_(),y("div",{key:l.id,class:"application-item"},[o("div",Xe,[o("div",Ye,[s(se,{size:40,src:l.student.avatar},null,8,["src"]),o("div",Ze,[o("div",je,d(l.student.name),1),o("div",et,d(l.student.school)+" · "+d(l.student.major),1)])]),o("div",tt,[o("div",st,d(l.job.title),1),o("div",ot,d(l.applyTime),1)])]),o("div",lt,[s(oe,{type:Z(l.status)},{default:a(()=>[m(d(j(l.status)),1)]),_:2},1032,["type"]),s(c,{size:"small",onClick:yt=>Y(l)},{default:a(()=>[...e[25]||(e[25]=[m(" 查看详情 ",-1)])]),_:1},8,["onClick"])])]))),128))])]),_:1}),s(f,{class:"jobs-section"},{header:a(()=>[o("div",at,[e[27]||(e[27]=o("h3",null,"岗位管理",-1)),s(c,{type:"text",onClick:e[3]||(e[3]=l=>t.$router.push("/company/jobs"))},{default:a(()=>[...e[26]||(e[26]=[m(" 管理全部 ",-1)])]),_:1})])]),default:a(()=>[o("div",nt,[S.value.length===0?(_(),y("div",it,[s(V,{description:"暂无发布岗位"})])):D("",!0),(_(!0),y(A,null,B(S.value,l=>(_(),y("div",{key:l.id,class:"job-item"},[o("div",rt,[o("h4",dt,d(l.title),1),o("div",ut,[o("span",ct,d(l.salary),1),o("span",pt,d(l.location),1),o("span",mt,d(l.workTime),1)]),o("div",_t,[o("span",null,"申请人数: "+d(l.applicationCount),1),o("span",null,"发布时间: "+d(l.publishTime),1)])]),o("div",ft,[s(c,{size:"small",onClick:()=>Q(l)},{default:a(()=>[...e[28]||(e[28]=[m("编辑",-1)])]),_:1},8,["onClick"]),s(c,{size:"small",type:"danger",onClick:()=>X(l)},{default:a(()=>[...e[29]||(e[29]=[m("删除",-1)])]),_:1},8,["onClick"])])]))),128))])]),_:1}),s(re,{modelValue:C.value,"onUpdate:modelValue":e[12]||(e[12]=l=>C.value=l),title:b.value?"编辑岗位":"发布新岗位",width:"600px"},{footer:a(()=>[s(c,{onClick:e[11]||(e[11]=l=>C.value=!1)},{default:a(()=>[...e[30]||(e[30]=[m("取消",-1)])]),_:1}),s(c,{type:"primary",onClick:K},{default:a(()=>[m(d(b.value?"更新岗位":"发布岗位"),1)]),_:1})]),default:a(()=>[s(ie,{model:n,rules:W,ref_key:"jobFormRef",ref:U,"label-width":"100px"},{default:a(()=>[s(w,{label:"岗位标题",prop:"title"},{default:a(()=>[s(x,{modelValue:n.title,"onUpdate:modelValue":e[4]||(e[4]=l=>n.title=l),placeholder:"请输入岗位标题"},null,8,["modelValue"])]),_:1}),s(w,{label:"薪资范围",prop:"salary"},{default:a(()=>[s(x,{modelValue:n.salary,"onUpdate:modelValue":e[5]||(e[5]=l=>n.salary=l),placeholder:"例如：200-300元/天"},null,8,["modelValue"])]),_:1}),s(w,{label:"工作地点",prop:"location"},{default:a(()=>[s(x,{modelValue:n.location,"onUpdate:modelValue":e[6]||(e[6]=l=>n.location=l),placeholder:"请输入工作地点"},null,8,["modelValue"])]),_:1}),s(w,{label:"工作时间",prop:"workTime"},{default:a(()=>[s(x,{modelValue:n.workTime,"onUpdate:modelValue":e[7]||(e[7]=l=>n.workTime=l),placeholder:"例如：每周3-5天"},null,8,["modelValue"])]),_:1}),s(w,{label:"招聘人数",prop:"recruitCount"},{default:a(()=>[s(le,{modelValue:n.recruitCount,"onUpdate:modelValue":e[8]||(e[8]=l=>n.recruitCount=l),min:1,max:50},null,8,["modelValue"])]),_:1}),s(w,{label:"岗位描述",prop:"description"},{default:a(()=>[s(x,{modelValue:n.description,"onUpdate:modelValue":e[9]||(e[9]=l=>n.description=l),type:"textarea",rows:4,placeholder:"请输入详细的岗位描述和要求"},null,8,["modelValue"])]),_:1}),s(w,{label:"岗位标签",prop:"tags"},{default:a(()=>[s(ne,{modelValue:n.tags,"onUpdate:modelValue":e[10]||(e[10]=l=>n.tags=l),multiple:"",filterable:"","allow-create":"",placeholder:"请选择或输入标签",style:{width:"100%"}},{default:a(()=>[(_(),y(A,null,B(G,l=>s(ae,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])])])}}});const ht=ke(vt,[["__scopeId","data-v-698179a2"]]);export{ht as default};
