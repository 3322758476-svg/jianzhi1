import{d as H,r,C as T,o as O,c as B,a as s,b as a,w as o,h as Q,E as C,i as n,j as W,k as f,l as X,a2 as Y,n as c,t as d,f as Z,p as k,F as j,e as ee,I as te,P as ae,V as le,_ as oe}from"./index-d856f604.js";import{c as D}from"./companyDataService-d2da87ef.js";const se={class:"company-jobs"},ne={class:"page-header"},ie={class:"header-actions"},re={class:"filter-content"},ce={class:"filter-actions"},ue={class:"table-header"},de={class:"total-count"},pe={class:"job-title-cell"},_e={class:"title"},me={class:"tags"},ve={class:"pagination-section"},fe=H({__name:"CompanyJobs",setup(ge){const J=Q(),p=r(""),_=r(""),m=r(1),g=r(10),h=r(!1),L=r(!1),N=r(null),x=r([]),z=async()=>{try{h.value=!0;const t=await D.getCompanyJobs({page:1,pageSize:100});x.value=t.jobs.map(e=>({id:e.id,title:e.title,salary:e.salary_range,location:e.work_location,workTime:e.work_hours,recruitCount:e.recruit_count||1,applicationCount:0,publishTime:e.created_at?new Date(e.created_at).toLocaleDateString("zh-CN"):"",status:e.status,description:e.description,tags:e.skills_required||[]}))}catch(t){console.error("加载公司岗位失败:",t),C.error("加载公司岗位失败: "+(t.message||"未知错误"))}finally{h.value=!1}},b=T(()=>{let t=x.value;if(p.value){const e=p.value.toLowerCase();t=t.filter(v=>v.title.toLowerCase().includes(e)||v.description.toLowerCase().includes(e)||v.tags.some(u=>u.toLowerCase().includes(e)))}return _.value&&(t=t.filter(e=>e.status===_.value)),t}),P=T(()=>{const t=(m.value-1)*g.value,e=t+g.value;return b.value.slice(t,e)}),E=()=>{J.push("/company/jobs/new")},F=t=>{console.log("editJob被调用，参数类型:",typeof t),console.log("editJob参数详情:",t),t&&typeof t=="object"&&t.id?(N.value=t,L.value=!0):(console.error("无效的岗位对象:",t),C.error("无法编辑该岗位，数据异常"))},U=async t=>{try{await le.confirm("确定要删除这个岗位吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await D.deleteJob(t.id),await z(),C.success("岗位删除成功")}catch(e){e!=="cancel"&&(console.error("删除岗位失败:",e),C.error("删除失败: "+(e.message||"未知错误")))}},I=t=>{J.push(`/company/applications?jobId=${t.id}`)},M=()=>{p.value="",_.value="",m.value=1},$=t=>{m.value=t};return O(async()=>{await z()}),(t,e)=>{const v=n("el-icon"),u=n("el-button"),q=n("el-input"),V=n("el-option"),A=n("el-select"),S=n("el-card"),w=n("el-tag"),i=n("el-table-column"),K=n("el-table"),R=n("el-pagination"),G=W("loading");return f(),B("div",se,[s("div",ne,[e[5]||(e[5]=s("h1",null,"岗位管理",-1)),s("div",ie,[a(u,{type:"primary",onClick:E},{default:o(()=>[a(v,null,{default:o(()=>[a(X(Y))]),_:1}),e[4]||(e[4]=c(" 发布新岗位 ",-1))]),_:1})])]),a(S,{class:"filter-card"},{default:o(()=>[s("div",re,[a(q,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=l=>p.value=l),placeholder:"搜索岗位标题或描述","prefix-icon":"Search",style:{width:"300px"},clearable:""},null,8,["modelValue"]),s("div",ce,[a(A,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=l=>_.value=l),placeholder:"岗位状态",clearable:""},{default:o(()=>[a(V,{label:"招聘中",value:"active"}),a(V,{label:"已结束",value:"inactive"})]),_:1},8,["modelValue"]),a(u,{onClick:M},{default:o(()=>[...e[6]||(e[6]=[c("重置",-1)])]),_:1})])])]),_:1}),a(S,null,{header:o(()=>[s("div",ue,[e[7]||(e[7]=s("span",null,"岗位列表",-1)),s("span",de,"共 "+d(b.value.length)+" 个岗位",1)])]),default:o(()=>[Z((f(),k(K,{data:P.value},{default:o(()=>[a(i,{prop:"title",label:"岗位标题","min-width":"200"},{default:o(({row:l})=>[s("div",pe,[s("div",_e,d(l.title),1),s("div",me,[(f(!0),B(j,null,ee(l.tags.slice(0,3),y=>(f(),k(w,{key:y,size:"small",type:"info"},{default:o(()=>[c(d(y),1)]),_:2},1024))),128)),l.tags.length>3?(f(),k(w,{key:0,size:"small",type:"info"},{default:o(()=>[c(" +"+d(l.tags.length-3),1)]),_:2},1024)):te("",!0)])])]),_:1}),a(i,{prop:"salary",label:"薪资",width:"120"}),a(i,{prop:"location",label:"地点",width:"120"}),a(i,{prop:"workTime",label:"工作时间",width:"120"}),a(i,{prop:"applicationCount",label:"申请人数",width:"100"},{default:o(({row:l})=>[s("span",{class:ae({"highlight-count":l.applicationCount>0})},d(l.applicationCount),3)]),_:1}),a(i,{prop:"publishTime",label:"发布时间",width:"120"}),a(i,{label:"状态",width:"100"},{default:o(({row:l})=>[a(w,{type:l.status==="active"?"success":"info"},{default:o(()=>[c(d(l.status==="active"?"招聘中":"已结束"),1)]),_:2},1032,["type"])]),_:1}),a(i,{label:"操作",width:"200",fixed:"right"},{default:o(({row:l})=>[a(u,{size:"small",onClick:y=>I(l)},{default:o(()=>[...e[8]||(e[8]=[c(" 查看申请 ",-1)])]),_:1},8,["onClick"]),a(u,{size:"small",type:"primary",onClick:()=>F(l)},{default:o(()=>[...e[9]||(e[9]=[c(" 编辑 ",-1)])]),_:1},8,["onClick"]),a(u,{size:"small",type:"danger",onClick:y=>U(l)},{default:o(()=>[...e[10]||(e[10]=[c(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,h.value]]),s("div",ve,[a(R,{"current-page":m.value,"onUpdate:currentPage":e[2]||(e[2]=l=>m.value=l),"page-size":g.value,"onUpdate:pageSize":e[3]||(e[3]=l=>g.value=l),total:b.value.length,layout:"prev, pager, next, jumper",onCurrentChange:$},null,8,["current-page","page-size","total"])])]),_:1})])}}});const he=oe(fe,[["__scopeId","data-v-f5f35301"]]);export{he as default};
