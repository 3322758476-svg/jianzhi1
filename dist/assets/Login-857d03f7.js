import{d as W,r as m,o as G,i as y,k as C,c as E,a as s,b as o,w as t,l as p,M as H,N as J,t as v,I as q,F as K,e as X,O as Y,n as d,E as u,_ as P,u as Z,B as S,P as I,h as ee,q as se,v as le,x as oe,Q as ne,R as M,s as A}from"./index-d856f604.js";const te={key:0,class:"login-error-display"},ae={class:"error-header"},ie={class:"error-content"},re={class:"error-message"},ue={key:0,class:"error-details"},de={class:"details-content"},ce={key:1,class:"suggestions"},me={class:"suggestions-list"},ge={key:2,class:"debug-info"},fe={class:"debug-content"},pe={class:"error-actions"},_e=W({__name:"LoginErrorDisplay",emits:["retry"],setup(j,{expose:L,emit:w}){const k=m(!1),f=m(!1),h=m(""),x=m(""),r=m(""),c=m(""),R=m(""),D=m(""),Q=m([]),N={invalid_credentials:["æ£€æŸ¥é‚®ç®±å’Œå¯†ç æ˜¯å¦æ­£ç¡®","ç¡®è®¤å¤§å°å†™è¾“å…¥æ­£ç¡®","å°è¯•é‡ç½®å¯†ç ","ç¡®è®¤è´¦å·ç±»åž‹ï¼ˆå­¦ç”Ÿ/ä¼ä¸šï¼‰"],email_not_confirmed:["è¯·å…ˆéªŒè¯é‚®ç®±åœ°å€","æ£€æŸ¥é‚®ç®±åžƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹","é‡æ–°å‘é€éªŒè¯é‚®ä»¶","è”ç³»å®¢æœååŠ©éªŒè¯"],user_not_found:["è¯·å…ˆæ³¨å†Œè´¦å·","æ£€æŸ¥é‚®ç®±åœ°å€æ˜¯å¦æ­£ç¡®","ç¡®è®¤è´¦å·ç±»åž‹","å°è¯•ä½¿ç”¨å…¶ä»–ç™»å½•æ–¹å¼"],too_many_requests:["è¯·ç­‰å¾…5åˆ†é’ŸåŽé‡è¯•","æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒCookie","å°è¯•ä½¿ç”¨å…¶ä»–æµè§ˆå™¨","è”ç³»æŠ€æœ¯æ”¯æŒ"],network_error:["æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æ˜¯å¦æ­£å¸¸","å°è¯•åˆ‡æ¢ç½‘ç»œçŽ¯å¢ƒ","åˆ·æ–°é¡µé¢åŽé‡è¯•","æ£€æŸ¥é˜²ç«å¢™è®¾ç½®"],timeout:["æœåŠ¡å™¨å“åº”è¶…æ—¶ï¼Œè¯·ç¨åŽé‡è¯•","æ£€æŸ¥ç½‘ç»œè¿žæŽ¥é€Ÿåº¦","å°è¯•åœ¨éžé«˜å³°æ—¶æ®µç™»å½•","è”ç³»æŠ€æœ¯æ”¯æŒ"],connection_failed:["æ— æ³•è¿žæŽ¥åˆ°æœåŠ¡å™¨","æ£€æŸ¥ç½‘ç»œä»£ç†è®¾ç½®","å°è¯•ä½¿ç”¨ç§»åŠ¨ç½‘ç»œ","è”ç³»ç½‘ç»œç®¡ç†å‘˜"],default:["æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åŽé‡è¯•","å°è¯•ä½¿ç”¨å…¶ä»–æµè§ˆå™¨","æ£€æŸ¥ç³»ç»Ÿæ—¶é—´æ˜¯å¦æ­£ç¡®","è”ç³»æŠ€æœ¯æ”¯æŒ"]},z=e=>{h.value=e.message,x.value=e.details||"",r.value=e.type,c.value=e.loginType,R.value=e.username,D.value=new Date().toLocaleString("zh-CN"),Q.value=N[e.type]||N.default,k.value=!0,f.value=!1},V=()=>{k.value=!1},O=()=>{V(),n("retry")},U=()=>{localStorage.removeItem("supabase.auth.token"),sessionStorage.clear(),u.success("ç¼“å­˜å·²æ¸…é™¤ï¼Œè¯·é‡æ–°ç™»å½•"),V()},n=w;return L({showErrorDisplay:z}),G(()=>{window.addEventListener("error",e=>{(e.message.includes("login")||e.message.includes("auth"))&&z({message:"ç³»ç»Ÿå‘ç”ŸæœªçŸ¥é”™è¯¯",details:e.message,type:"system_error",loginType:"unknown",username:""})})}),(e,l)=>{const a=y("el-icon"),g=y("el-button");return k.value?(C(),E("div",te,[s("div",ae,[o(a,{class:"error-icon"},{default:t(()=>[o(p(H))]),_:1}),l[1]||(l[1]=s("span",{class:"error-title"},"ç™»å½•å¼‚å¸¸",-1)),o(g,{size:"small",type:"text",onClick:V,class:"close-btn"},{default:t(()=>[o(a,null,{default:t(()=>[o(p(J))]),_:1})]),_:1})]),s("div",ie,[s("div",re,v(h.value),1),x.value?(C(),E("div",ue,[l[2]||(l[2]=s("div",{class:"details-header"},"è¯¦ç»†ä¿¡æ¯:",-1)),s("div",de,v(x.value),1)])):q("",!0),Q.value.length>0?(C(),E("div",ce,[l[3]||(l[3]=s("div",{class:"suggestions-header"},"å»ºè®®è§£å†³æ–¹æ¡ˆ:",-1)),s("ul",me,[(C(!0),E(K,null,X(Q.value,(b,$)=>(C(),E("li",{key:$},[o(a,{class:"suggestion-icon"},{default:t(()=>[o(p(Y))]),_:1}),d(" "+v(b),1)]))),128))])])):q("",!0),f.value?(C(),E("div",ge,[l[8]||(l[8]=s("div",{class:"debug-header"},"è°ƒè¯•ä¿¡æ¯:",-1)),s("div",fe,[s("div",null,[l[4]||(l[4]=s("strong",null,"é”™è¯¯ç±»åž‹:",-1)),d(" "+v(r.value),1)]),s("div",null,[l[5]||(l[5]=s("strong",null,"æ—¶é—´:",-1)),d(" "+v(D.value),1)]),s("div",null,[l[6]||(l[6]=s("strong",null,"ç™»å½•ç±»åž‹:",-1)),d(" "+v(c.value),1)]),s("div",null,[l[7]||(l[7]=s("strong",null,"è´¦å·:",-1)),d(" "+v(R.value),1)])])])):q("",!0)]),s("div",pe,[o(g,{size:"small",onClick:O,type:"primary"},{default:t(()=>[...l[9]||(l[9]=[d("é‡è¯•ç™»å½•",-1)])]),_:1}),o(g,{size:"small",onClick:l[0]||(l[0]=b=>f.value=!f.value)},{default:t(()=>[d(v(f.value?"éšè—":"æ˜¾ç¤º")+"è°ƒè¯•ä¿¡æ¯ ",1)]),_:1}),o(g,{size:"small",onClick:U},{default:t(()=>[...l[10]||(l[10]=[d("æ¸…é™¤ç¼“å­˜",-1)])]),_:1})])])):q("",!0)}}});const ve=P(_e,[["__scopeId","data-v-cfd29ca6"]]),ye={class:"login-container"},we={class:"login-form"},ke={class:"role-selection"},be={class:"role-icon"},$e={class:"role-icon"},Ce={class:"form-options"},Ee={class:"social-login"},Le={class:"register-link"},he={class:"login-banner"},xe={class:"banner-content"},Te={class:"features"},De={class:"feature-item"},Qe={class:"feature-item"},Ve={class:"feature-item"},Re={class:"feature-item"},Ne=W({__name:"Login",setup(j){const L=ee(),w=Z(),k=m(),f=m(),h=m(!1),x=m(!1),r=m("student"),c=S({username:"",password:""}),R={username:[{required:!0,message:"è¯·è¾“å…¥è´¦å·",trigger:"blur"}],password:[{required:!0,message:"è¯·è¾“å…¥å¯†ç ",trigger:"blur"},{min:6,message:"å¯†ç é•¿åº¦ä¸èƒ½å°‘äºŽ6ä½",trigger:"blur"}]},D=async()=>{var n,e,l,a,g,b,$,T,F,_,B;if(k.value)try{await k.value.validate(),h.value=!0,console.log("ðŸ” ç™»å½•è¯Šæ–­ä¿¡æ¯:"),console.log("ç™»å½•ç±»åž‹:",r.value),console.log("è´¦å·:",c.username),console.log("å¯†ç é•¿åº¦:",c.password.length),(await w.login({username:c.username,password:c.password,type:r.value})).success?(console.log("âœ… ç™»å½•æˆåŠŸ"),r.value==="company"&&((n=w.user)==null?void 0:n.role)!=="company"?(console.warn("âš ï¸ è§’è‰²ä¸åŒ¹é…: ç”¨æˆ·è§’è‰²ä¸º",(e=w.user)==null?void 0:e.role,"ä½†ç™»å½•ç±»åž‹ä¸ºä¼ä¸š"),u.warning("å½“å‰è´¦å·ä¸æ˜¯ä¼ä¸šè´¦å·ï¼Œå·²è‡ªåŠ¨åˆ‡æ¢åˆ°å­¦ç”Ÿæ¨¡å¼")):r.value==="student"&&((l=w.user)==null?void 0:l.role)!=="student"&&(console.warn("âš ï¸ è§’è‰²ä¸åŒ¹é…: ç”¨æˆ·è§’è‰²ä¸º",(a=w.user)==null?void 0:a.role,"ä½†ç™»å½•ç±»åž‹ä¸ºå­¦ç”Ÿ"),u.warning("å½“å‰è´¦å·ä¸æ˜¯å­¦ç”Ÿè´¦å·ï¼Œå·²è‡ªåŠ¨åˆ‡æ¢åˆ°ä¼ä¸šæ¨¡å¼")),((g=w.user)==null?void 0:g.role)==="company"?(console.log("ä¼ä¸šç™»å½•æˆåŠŸ"),L.push("/company/dashboard")):(console.log("å­¦ç”Ÿç™»å½•æˆåŠŸ"),L.push("/"))):(console.error("âŒ ç™»å½•å¤±è´¥: æœªçŸ¥é”™è¯¯"),Q("ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·å’Œå¯†ç "))}catch(i){console.error("âŒ ç™»å½•å¼‚å¸¸:",i),console.error("å¼‚å¸¸è¯¦æƒ…:",i.stack),(b=i.message)!=null&&b.includes("Network Error")?u.error("ç½‘ç»œè¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåŽé‡è¯•"):($=i.message)!=null&&$.includes("timeout")?u.error("è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åŽé‡è¯•"):(T=i.message)!=null&&T.includes("Failed to fetch")?u.error("æ— æ³•è¿žæŽ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥"):(F=i.message)!=null&&F.includes("CORS")?u.error("è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®"):(_=i.message)!=null&&_.includes("SSL")?u.error("å®‰å…¨è¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¯ä¹¦è®¾ç½®"):(B=i.message)!=null&&B.includes("certificate")?u.error("è¯ä¹¦éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥å®‰å…¨è®¾ç½®"):(console.group("ðŸ” è¯¦ç»†ç™»å½•å¼‚å¸¸è¯Šæ–­"),console.log("é”™è¯¯ç±»åž‹:",typeof i),console.log("é”™è¯¯æ¶ˆæ¯:",i.message),console.log("é”™è¯¯åç§°:",i.name),console.log("é”™è¯¯ä»£ç :",i.code),console.log("å®Œæ•´é”™è¯¯å¯¹è±¡:",i),console.groupEnd(),u.error("ç™»å½•å¼‚å¸¸ï¼Œè¯·ç¨åŽé‡è¯•ã€‚å¦‚æžœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒ")),f.value&&f.value.showErrorDisplay({message:"ç³»ç»Ÿå‘ç”ŸæœªçŸ¥é”™è¯¯",details:`é”™è¯¯ç±»åž‹: ${typeof i}
é”™è¯¯æ¶ˆæ¯: ${i.message||"æ— "}
é”™è¯¯åç§°: ${i.name||"æ— "}
é”™è¯¯ä»£ç : ${i.code||"æ— "}`,type:"system_error",loginType:r.value,username:c.username})}finally{h.value=!1}},Q=n=>{console.error("âŒ handleLoginError æŽ¥æ”¶åˆ°çš„é”™è¯¯:",n);const e=typeof n=="string"?n:n!=null&&n.message?n.message:n!=null&&n.toString?n.toString():"æœªçŸ¥é”™è¯¯";let l="ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·å’Œå¯†ç ",a="unknown";e!=null&&e.includes("Invalid login credentials")?(l="è´¦å·æˆ–å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥",a="invalid_credentials"):e!=null&&e.includes("Email not confirmed")||e==="EMAIL_NOT_CONFIRMED"?(l="é‚®ç®±æœªéªŒè¯ï¼Œè¯·å…ˆéªŒè¯é‚®ç®±åŽå†ç™»å½•",a="email_not_confirmed"):e!=null&&e.includes("User not found")?(l="è´¦å·ä¸å­˜åœ¨ï¼Œè¯·å…ˆæ³¨å†Œæˆ–æ£€æŸ¥è´¦å·æ˜¯å¦æ­£ç¡®",a="user_not_found"):e!=null&&e.includes("Too many requests")?(l="ç™»å½•å°è¯•è¿‡äºŽé¢‘ç¹ï¼Œè¯·ç­‰å¾…5åˆ†é’ŸåŽå†è¯•",a="too_many_requests"):e!=null&&e.includes("Network Error")?(l="ç½‘ç»œè¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥åŽé‡è¯•",a="network_error"):e!=null&&e.includes("timeout")?(l="è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åŽé‡è¯•",a="timeout"):e!=null&&e.includes("Failed to fetch")?(l="æ— æ³•è¿žæŽ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥",a="connection_failed"):e&&(l=`ç™»å½•å¤±è´¥: ${e}`,a="other_error"),console.error(`âŒ ç™»å½•é”™è¯¯ç±»åž‹: ${a}, é”™è¯¯ä¿¡æ¯: ${e}`),u.error({message:l,duration:5e3,showClose:!0}),f.value&&f.value.showErrorDisplay({message:l,details:e,type:a,loginType:r.value,username:c.username})},N=()=>{console.log("ðŸ”„ é‡è¯•ç™»å½•"),D()},z=async()=>{console.log("æ­£åœ¨è·³è½¬åˆ°å¾®ä¿¡æŽˆæƒ...");try{const{error:n}=await A.auth.signInWithOAuth({provider:"github",options:{redirectTo:window.location.origin}});n&&u.error(`å¾®ä¿¡ç™»å½•å¤±è´¥: ${n.message}`)}catch(n){u.error("å¾®ä¿¡ç™»å½•å¼‚å¸¸ï¼Œè¯·ç¨åŽé‡è¯•"),console.error("å¾®ä¿¡ç™»å½•å¼‚å¸¸:",n)}},V=async()=>{u.info("æ­£åœ¨è·³è½¬åˆ°QQæŽˆæƒ...");try{const{error:n}=await A.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}});n&&u.error(`QQç™»å½•å¤±è´¥: ${n.message}`)}catch(n){u.error("QQç™»å½•å¼‚å¸¸ï¼Œè¯·ç¨åŽé‡è¯•"),console.error("QQç™»å½•å¼‚å¸¸:",n)}},O=()=>{L.push("/forgot-password")},U=()=>{L.push("/register")};return(n,e)=>{const l=y("el-icon"),a=y("el-input"),g=y("el-form-item"),b=y("el-checkbox"),$=y("el-link"),T=y("el-button"),F=y("el-form");return C(),E("div",ye,[o(ve,{ref_key:"errorDisplayRef",ref:f,onRetry:N},null,512),s("div",we,[e[18]||(e[18]=s("div",{class:"form-header"},[s("h2",null,"ç™»å½•å¤§å­¦ç”Ÿå…¼èŒå¹³å°"),s("p",null,"è¯·é€‰æ‹©æ‚¨çš„èº«ä»½ç±»åž‹ç™»å½•")],-1)),s("div",ke,[s("div",{class:I(["role-card",{active:r.value==="student"}]),onClick:e[0]||(e[0]=_=>r.value="student")},[s("div",be,[o(l,null,{default:t(()=>[o(p(se))]),_:1})]),e[5]||(e[5]=s("h3",null,"å­¦ç”Ÿç™»å½•",-1)),e[6]||(e[6]=s("p",null,"å¯»æ‰¾å…¼èŒæœºä¼šï¼Œç§¯ç´¯å·¥ä½œç»éªŒ",-1)),e[7]||(e[7]=s("ul",{class:"role-features"},[s("li",null,"æµè§ˆæµ·é‡å…¼èŒå²—ä½"),s("li",null,"ä¸€é”®æŠ•é€’ç®€åŽ†"),s("li",null,"ä¸Žä¼ä¸šå®žæ—¶æ²Ÿé€š"),s("li",null,"ç®¡ç†ç”³è¯·è®°å½•")],-1))],2),s("div",{class:I(["role-card",{active:r.value==="company"}]),onClick:e[1]||(e[1]=_=>r.value="company")},[s("div",$e,[o(l,null,{default:t(()=>[o(p(le))]),_:1})]),e[8]||(e[8]=s("h3",null,"ä¼ä¸šç™»å½•",-1)),e[9]||(e[9]=s("p",null,"å‘å¸ƒå…¼èŒå²—ä½ï¼Œæ‹›è˜ä¼˜ç§€äººæ‰",-1)),e[10]||(e[10]=s("ul",{class:"role-features"},[s("li",null,"å‘å¸ƒå’Œç®¡ç†å²—ä½"),s("li",null,"æŸ¥çœ‹å­¦ç”Ÿç®€åŽ†"),s("li",null,"ä¸Žå­¦ç”Ÿæ²Ÿé€šè”ç³»"),s("li",null,"ç®¡ç†æ‹›è˜æµç¨‹")],-1))],2)]),o(F,{ref_key:"loginFormRef",ref:k,model:c,rules:R,"label-width":"80px",class:"login-form-content"},{default:t(()=>[o(g,{label:r.value==="student"?"å­¦å·/é‚®ç®±":"ä¼ä¸šè´¦å·",prop:"username"},{default:t(()=>[o(a,{modelValue:c.username,"onUpdate:modelValue":e[2]||(e[2]=_=>c.username=_),placeholder:r.value==="student"?"è¯·è¾“å…¥å­¦å·æˆ–é‚®ç®±":"è¯·è¾“å…¥ä¼ä¸šè´¦å·",size:"large"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(g,{label:"å¯†ç ",prop:"password"},{default:t(()=>[o(a,{modelValue:c.password,"onUpdate:modelValue":e[3]||(e[3]=_=>c.password=_),type:"password",placeholder:"è¯·è¾“å…¥å¯†ç ",size:"large","show-password":""},null,8,["modelValue"])]),_:1}),o(g,null,{default:t(()=>[s("div",Ce,[o(b,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=_=>x.value=_)},{default:t(()=>[...e[11]||(e[11]=[d("è®°ä½æˆ‘",-1)])]),_:1},8,["modelValue"]),o($,{type:"primary",onClick:O},{default:t(()=>[...e[12]||(e[12]=[d("å¿˜è®°å¯†ç ï¼Ÿ",-1)])]),_:1})])]),_:1}),o(g,null,{default:t(()=>[o(T,{type:"primary",size:"large",class:"login-btn",loading:h.value,onClick:D},{default:t(()=>[d(v(r.value==="student"?"å­¦ç”Ÿç™»å½•":"ä¼ä¸šç™»å½•"),1)]),_:1},8,["loading"])]),_:1}),e[17]||(e[17]=s("div",{class:"divider"},[s("span",null,"æˆ–ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ç™»å½•")],-1)),s("div",Ee,[o(T,{class:"social-btn wechat",onClick:z},{default:t(()=>[o(l,null,{default:t(()=>[o(p(oe))]),_:1}),e[13]||(e[13]=d(" å¾®ä¿¡ç™»å½• ",-1))]),_:1}),o(T,{class:"social-btn qq",onClick:V},{default:t(()=>[o(l,null,{default:t(()=>[o(p(ne))]),_:1}),e[14]||(e[14]=d(" QQç™»å½• ",-1))]),_:1})]),s("div",Le,[e[16]||(e[16]=d(" è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ ",-1)),o($,{type:"primary",onClick:U},{default:t(()=>[...e[15]||(e[15]=[d("ç«‹å³æ³¨å†Œ",-1)])]),_:1})])]),_:1},8,["model"])]),s("div",he,[s("div",xe,[e[23]||(e[23]=s("h3",null,"è¿žæŽ¥ä¼˜ç§€å¤§å­¦ç”Ÿä¸Žä¼˜è´¨ä¼ä¸š",-1)),e[24]||(e[24]=s("p",null,"å®‰å…¨å¯é çš„å…¼èŒå¹³å°ï¼Œä¸ºæ‚¨çš„èŒä¸šç”Ÿæ¶¯ä¿é©¾æŠ¤èˆª",-1)),s("div",Te,[s("div",De,[o(l,null,{default:t(()=>[o(p(M))]),_:1}),e[19]||(e[19]=s("span",null,"æµ·é‡ä¼˜è´¨å…¼èŒå²—ä½",-1))]),s("div",Qe,[o(l,null,{default:t(()=>[o(p(M))]),_:1}),e[20]||(e[20]=s("span",null,"ä¼ä¸šå®žåè®¤è¯",-1))]),s("div",Ve,[o(l,null,{default:t(()=>[o(p(M))]),_:1}),e[21]||(e[21]=s("span",null,"å®Œå–„çš„è¯„ä»·ä½“ç³»",-1))]),s("div",Re,[o(l,null,{default:t(()=>[o(p(M))]),_:1}),e[22]||(e[22]=s("span",null,"å®žæ—¶æ²Ÿé€šåŠŸèƒ½",-1))])])])])])}}});const Fe=P(Ne,[["__scopeId","data-v-3be3abca"]]);export{Fe as default};
