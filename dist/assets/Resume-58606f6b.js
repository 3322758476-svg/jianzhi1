import{d as H,u as J,r as D,B as K,o as Q,E as v,c as C,a as n,b as o,w as t,h as Y,s as j,i as c,j as Z,k,n as p,t as f,p as h,I as x,f as ee,l as N,a3 as le,a4 as oe,_ as te}from"./index-d856f604.js";const ae={class:"resume"},se={class:"resume-content"},re={class:"card-header"},ne={class:"header-actions"},de={key:0,class:"uploaded-resume"},ue={class:"resume-name"},ie={key:0,class:"resume-preview"},pe={class:"preview-content"},me=H({__name:"Resume",setup(fe){const q=Y(),_=J(),r=D(!1),w=D(!1),U=D(),g=D(""),R=D(""),l=K({name:"",gender:"male",birthDate:"",phone:"",email:"",school:"",major:"",education:"bachelor",enrollmentDate:"",skills:"",languages:"",internships:"",projects:"",introduction:""}),B={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],school:[{required:!0,message:"请输入学校名称",trigger:"blur"}],major:[{required:!0,message:"请输入专业名称",trigger:"blur"}]},F=d=>{const e=d.type==="application/pdf",u=d.type==="application/msword"||d.type==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",a=d.type==="text/plain",i=d.size/1024/1024<5;return!e&&!u&&!a?(v.error("简历文件只能是 PDF、Word 或 TXT 格式!"),!1):i?!0:(v.error("简历文件大小不能超过 5MB!"),!1)},T=async d=>{var u;const e=d.file;try{w.value=!0;const a=e.name.split(".").pop(),V=`resumes/${`${(u=_.user)==null?void 0:u.id}_${Date.now()}.${a}`}`,{data:m,error:y}=await j.storage.from("resumes").upload(V,e);if(y)throw y;const{data:{publicUrl:b}}=j.storage.from("resumes").getPublicUrl(V);g.value=b,R.value=e.name,v.success("简历文件上传成功")}catch(a){console.error("上传简历文件失败:",a),v.error("上传简历文件失败，请重试")}finally{w.value=!1}},E=()=>{g.value&&window.open(g.value,"_blank")},L=async()=>{try{if(g.value){const d=g.value.split("/"),u=`resumes/${d[d.length-1]}`,{error:a}=await j.storage.from("resumes").remove([u]);if(a)throw a;g.value="",R.value="",v.success("简历文件已删除")}}catch(d){console.error("删除简历文件失败:",d),v.error("删除简历文件失败，请重试")}},M=async()=>{var d;if(U.value)try{await U.value.validate(),w.value=!0;const{data:e}=await j.from("students").select("id").eq("user_id",(d=_.user)==null?void 0:d.id).single();if(!e)throw new Error("未找到学生信息，请先完善个人信息");const u={real_name:l.name,phone:l.phone,school:l.school,major:l.major,skills:l.skills?[l.skills]:[],experience:l.internships,updated_at:new Date().toISOString()};g.value&&(u.resume_url=g.value);const{error:a}=await j.from("students").update(u).eq("id",e.id);if(a)throw a;v.success("简历保存成功"),r.value=!1}catch(e){console.error("保存简历失败:",e),v.error(e.message||"请完善必填信息")}finally{w.value=!1}},S=()=>{U.value&&U.value.resetFields()},O=()=>{try{const d=`
个人简历

基本信息：
姓名：${l.name}
性别：${l.gender==="male"?"男":"女"}
出生日期：${l.birthDate}
联系电话：${l.phone}
邮箱：${l.email}

教育背景：
学校：${l.school}
专业：${l.major}
学历：${l.education}
入学时间：${l.enrollmentDate}

专业技能：
${l.skills}

语言能力：
${l.languages}

实习经历：
${l.internships}

项目经验：
${l.projects}

自我评价：
${l.introduction}
    `.trim(),e=new Blob([d],{type:"text/plain;charset=utf-8"}),u=URL.createObjectURL(e),a=document.createElement("a");a.href=u,a.download=`${l.name}_简历.txt`,a.click(),URL.revokeObjectURL(u),v.success("简历下载成功")}catch(d){console.error("下载简历失败:",d),v.error("下载简历失败，请重试")}},I=async()=>{var d,e,u,a,i,V;try{w.value=!0;const{data:m,error:y}=await j.from("students").select("*").eq("user_id",(d=_.user)==null?void 0:d.id).single();if(y)throw y;if(m&&(Object.assign(l,{name:m.real_name||"",gender:"male",birthDate:"",phone:m.phone||"",email:((e=_.user)==null?void 0:e.email)||"",school:m.school||"",major:m.major||"",education:"bachelor",enrollmentDate:"",skills:((u=m.skills)==null?void 0:u.join(", "))||"",languages:"",internships:m.experience||"",projects:"",introduction:""}),m.resume_url)){g.value=m.resume_url;const b=m.resume_url.split("/");R.value=b[b.length-1]||"简历文件"}}catch(m){console.error("加载简历数据失败:",m),m.code==="PGRST116"&&Object.assign(l,{name:((a=_.user)==null?void 0:a.username)||"",email:((i=_.user)==null?void 0:i.email)||"",phone:((V=_.user)==null?void 0:V.phone)||""})}finally{w.value=!1}};return Q(()=>{_.isAuthenticated?(I(),document.referrer.includes("/profile")&&(r.value=!0)):(v.warning("请先登录后再编辑简历"),q.push("/login"))}),(d,e)=>{const u=c("el-button"),a=c("el-input"),i=c("el-form-item"),V=c("el-radio"),m=c("el-radio-group"),y=c("el-date-picker"),b=c("el-divider"),$=c("el-option"),W=c("el-select"),P=c("el-icon"),X=c("el-upload"),z=c("el-form"),A=c("el-card"),G=Z("loading");return k(),C("div",ae,[e[38]||(e[38]=n("div",{class:"page-header"},[n("h1",null,"我的简历"),n("p",null,"完善您的个人简历，提高求职成功率")],-1)),n("div",se,[o(A,{class:"resume-card"},{header:t(()=>[n("div",re,[e[16]||(e[16]=n("span",null,"简历信息",-1)),n("div",ne,[o(u,{type:"primary",onClick:e[0]||(e[0]=s=>r.value=!r.value)},{default:t(()=>[p(f(r.value?"取消编辑":"编辑简历"),1)]),_:1}),r.value?x("",!0):(k(),h(u,{key:0,type:"success",onClick:O},{default:t(()=>[...e[15]||(e[15]=[p(" 下载简历 ",-1)])]),_:1}))])])]),default:t(()=>[ee((k(),h(z,{model:l,rules:B,ref_key:"resumeFormRef",ref:U,"label-width":"100px"},{default:t(()=>[o(i,{label:"姓名",prop:"name"},{default:t(()=>[o(a,{modelValue:l.name,"onUpdate:modelValue":e[1]||(e[1]=s=>l.name=s),disabled:!r.value,placeholder:"请输入您的姓名"},null,8,["modelValue","disabled"])]),_:1}),o(i,{label:"性别",prop:"gender"},{default:t(()=>[o(m,{modelValue:l.gender,"onUpdate:modelValue":e[2]||(e[2]=s=>l.gender=s),disabled:!r.value},{default:t(()=>[o(V,{label:"male"},{default:t(()=>[...e[17]||(e[17]=[p("男",-1)])]),_:1}),o(V,{label:"female"},{default:t(()=>[...e[18]||(e[18]=[p("女",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),o(i,{label:"出生日期",prop:"birthDate"},{default:t(()=>[o(y,{modelValue:l.birthDate,"onUpdate:modelValue":e[3]||(e[3]=s=>l.birthDate=s),type:"date",placeholder:"选择日期",disabled:!r.value,style:{width:"100%"}},null,8,["modelValue","disabled"])]),_:1}),o(i,{label:"联系电话",prop:"phone"},{default:t(()=>[o(a,{modelValue:l.phone,"onUpdate:modelValue":e[4]||(e[4]=s=>l.phone=s),disabled:!r.value,placeholder:"请输入联系电话"},null,8,["modelValue","disabled"])]),_:1}),o(i,{label:"邮箱",prop:"email"},{default:t(()=>[o(a,{modelValue:l.email,"onUpdate:modelValue":e[5]||(e[5]=s=>l.email=s),disabled:!r.value,placeholder:"请输入邮箱地址"},null,8,["modelValue","disabled"])]),_:1}),o(b,{"content-position":"left"},{default:t(()=>[...e[19]||(e[19]=[p("教育背景",-1)])]),_:1}),o(i,{label:"学校",prop:"school"},{default:t(()=>[o(a,{modelValue:l.school,"onUpdate:modelValue":e[6]||(e[6]=s=>l.school=s),disabled:!r.value,placeholder:"请输入学校名称"},null,8,["modelValue","disabled"])]),_:1}),o(i,{label:"专业",prop:"major"},{default:t(()=>[o(a,{modelValue:l.major,"onUpdate:modelValue":e[7]||(e[7]=s=>l.major=s),disabled:!r.value,placeholder:"请输入专业名称"},null,8,["modelValue","disabled"])]),_:1}),o(i,{label:"学历",prop:"education"},{default:t(()=>[o(W,{modelValue:l.education,"onUpdate:modelValue":e[8]||(e[8]=s=>l.education=s),disabled:!r.value,placeholder:"请选择学历",style:{width:"100%"}},{default:t(()=>[o($,{label:"本科",value:"bachelor"}),o($,{label:"硕士",value:"master"}),o($,{label:"博士",value:"doctor"}),o($,{label:"专科",value:"college"})]),_:1},8,["modelValue","disabled"])]),_:1}),o(i,{label:"入学时间",prop:"enrollmentDate"},{default:t(()=>[o(y,{modelValue:l.enrollmentDate,"onUpdate:modelValue":e[9]||(e[9]=s=>l.enrollmentDate=s),type:"month",placeholder:"选择月份",disabled:!r.value,style:{width:"100%"}},null,8,["modelValue","disabled"])]),_:1}),o(b,{"content-position":"left"},{default:t(()=>[...e[20]||(e[20]=[p("技能特长",-1)])]),_:1}),o(i,{label:"专业技能",prop:"skills"},{default:t(()=>[o(a,{type:"textarea",rows:3,modelValue:l.skills,"onUpdate:modelValue":e[10]||(e[10]=s=>l.skills=s),disabled:!r.value,placeholder:"请描述您的专业技能，如：熟练掌握Vue.js、React等前端框架，了解Node.js后端开发..."},null,8,["modelValue","disabled"])]),_:1}),o(i,{label:"语言能力",prop:"languages"},{default:t(()=>[o(a,{type:"textarea",rows:2,modelValue:l.languages,"onUpdate:modelValue":e[11]||(e[11]=s=>l.languages=s),disabled:!r.value,placeholder:"请描述您的语言能力，如：英语CET-6，能够流利阅读英文文档..."},null,8,["modelValue","disabled"])]),_:1}),o(b,{"content-position":"left"},{default:t(()=>[...e[21]||(e[21]=[p("工作经历",-1)])]),_:1}),o(i,{label:"实习经历",prop:"internships"},{default:t(()=>[o(a,{type:"textarea",rows:4,modelValue:l.internships,"onUpdate:modelValue":e[12]||(e[12]=s=>l.internships=s),disabled:!r.value,placeholder:"请描述您的实习经历，包括公司名称、职位、工作内容和收获..."},null,8,["modelValue","disabled"])]),_:1}),o(i,{label:"项目经验",prop:"projects"},{default:t(()=>[o(a,{type:"textarea",rows:4,modelValue:l.projects,"onUpdate:modelValue":e[13]||(e[13]=s=>l.projects=s),disabled:!r.value,placeholder:"请描述您参与的项目经验，包括项目名称、技术栈、个人贡献..."},null,8,["modelValue","disabled"])]),_:1}),o(b,{"content-position":"left"},{default:t(()=>[...e[22]||(e[22]=[p("自我评价",-1)])]),_:1}),o(i,{label:"个人简介",prop:"introduction"},{default:t(()=>[o(a,{type:"textarea",rows:4,modelValue:l.introduction,"onUpdate:modelValue":e[14]||(e[14]=s=>l.introduction=s),disabled:!r.value,placeholder:"请简要介绍您的个人特点、职业目标等..."},null,8,["modelValue","disabled"])]),_:1}),o(b,{"content-position":"left"},{default:t(()=>[...e[23]||(e[23]=[p("简历文件上传",-1)])]),_:1}),o(i,{label:"上传简历文件"},{default:t(()=>[o(X,{class:"resume-uploader",action:"#","show-file-list":!1,"before-upload":F,"http-request":T,accept:".pdf,.doc,.docx,.txt",disabled:!r.value},{tip:t(()=>[...e[25]||(e[25]=[n("div",{class:"el-upload__tip"}," 支持 PDF、Word、TXT 格式，文件大小不超过 5MB ",-1)])]),default:t(()=>[o(u,{type:"primary",disabled:!r.value},{default:t(()=>[o(P,null,{default:t(()=>[o(N(le))]),_:1}),e[24]||(e[24]=p(" 选择简历文件 ",-1))]),_:1},8,["disabled"])]),_:1},8,["disabled"]),g.value?(k(),C("div",de,[o(P,null,{default:t(()=>[o(N(oe))]),_:1}),n("span",ue,f(R.value),1),o(u,{type:"text",onClick:E},{default:t(()=>[...e[26]||(e[26]=[p("下载",-1)])]),_:1}),r.value?(k(),h(u,{key:0,type:"text",onClick:L},{default:t(()=>[...e[27]||(e[27]=[p("删除",-1)])]),_:1})):x("",!0)])):x("",!0)]),_:1}),r.value?(k(),h(i,{key:0},{default:t(()=>[o(u,{type:"primary",onClick:M},{default:t(()=>[...e[28]||(e[28]=[p("保存简历",-1)])]),_:1}),o(u,{onClick:S},{default:t(()=>[...e[29]||(e[29]=[p("重置",-1)])]),_:1})]),_:1})):x("",!0)]),_:1},8,["model"])),[[G,w.value]]),r.value?x("",!0):(k(),C("div",ie,[o(b,{"content-position":"left"},{default:t(()=>[...e[30]||(e[30]=[p("简历预览",-1)])]),_:1}),n("div",pe,[n("h3",null,f(l.name)+" - 个人简历",1),n("p",null,[e[31]||(e[31]=n("strong",null,"基本信息：",-1)),p(f(l.gender==="male"?"男":"女")+" | "+f(l.birthDate)+" | "+f(l.phone)+" | "+f(l.email),1)]),n("p",null,[e[32]||(e[32]=n("strong",null,"教育背景：",-1)),p(f(l.school)+" | "+f(l.major)+" | "+f(l.education),1)]),n("p",null,[e[33]||(e[33]=n("strong",null,"专业技能：",-1)),p(f(l.skills),1)]),n("p",null,[e[34]||(e[34]=n("strong",null,"语言能力：",-1)),p(f(l.languages),1)]),n("p",null,[e[35]||(e[35]=n("strong",null,"实习经历：",-1)),p(f(l.internships),1)]),n("p",null,[e[36]||(e[36]=n("strong",null,"项目经验：",-1)),p(f(l.projects),1)]),n("p",null,[e[37]||(e[37]=n("strong",null,"自我评价：",-1)),p(f(l.introduction),1)])])]))]),_:1})])])}}});const be=te(me,[["__scopeId","data-v-6ad1b141"]]);export{be as default};
