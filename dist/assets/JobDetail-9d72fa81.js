import{d as Q,u as W,C as X,r as q,B as Y,o as Z,c as T,a as t,b as a,w as l,J as ee,h as te,s as y,E as c,i as p,k as g,l as x,K as se,n as v,t as n,p as $,L as oe,I as ae,F as z,e as E,_ as le}from"./index-d856f604.js";const ne={class:"job-detail-page"},ie={class:"container"},re={class:"back-section"},ue={class:"job-header"},de={class:"job-title-section"},ce={class:"job-meta"},pe={class:"job-actions"},_e={class:"job-content"},me={class:"info-section"},ve={class:"info-grid"},fe={class:"info-item"},ye={class:"value"},ge={class:"info-item"},be={class:"value"},we={class:"info-item"},he={class:"value"},ke={class:"info-item"},qe={class:"value"},Ce={class:"info-item"},De={class:"value"},je={class:"info-item"},Se={class:"value"},Ve={class:"description-section"},Te={class:"description-content"},xe={class:"requirements-section"},Ae={class:"requirements-list"},Ie={class:"tags-section"},$e={class:"tags-list"},ze={class:"company-section"},Ee={class:"company-info"},Fe={class:"company-header"},Je={class:"company-details"},Le={class:"company-industry"},Me={class:"company-size"},Be={class:"company-description"},Ne={class:"map-section"},Re={class:"map-placeholder"},Ue=Q({__name:"JobDetail",setup(He){const L=ee(),A=te(),b=W(),C=X(()=>L.params.id),F=q(!1),o=q({id:"",title:"",company:"",location:"",salary:"",workTime:"",recruitCount:0,applicationCount:0,publishTime:"",description:"",requirements:[],tags:[],companyLogo:"",industry:"",companySize:"",companyDescription:"",address:""}),D=q(!1),w=q(!1),h=q(!1),_=Y({resumeId:"",message:""}),f=q([]),M=async()=>{var s;try{f.value=[];const{data:e,error:i}=await y.from("students").select("id, real_name, resume_url").eq("user_id",(s=b.user)==null?void 0:s.id).single();if(i){console.warn("获取学生信息失败，使用默认简历选项:",i),f.value=[{id:"text_resume",title:"文本简历",url:null}];return}e?(e.resume_url&&f.value.push({id:"uploaded_resume",title:`${e.real_name||"我的"}简历文件`,url:e.resume_url}),f.value.push({id:"text_resume",title:"文本简历",url:null})):f.value=[{id:"text_resume",title:"文本简历",url:null}]}catch(e){console.error("加载简历数据失败:",e),f.value=[{id:"text_resume",title:"文本简历",url:null}]}},B=async()=>{var s;if(!b.isAuthenticated){c.warning("请先登录"),A.push("/login");return}if(((s=b.user)==null?void 0:s.role)!=="student"){c.warning("只有学生用户可以申请岗位");return}if(await M(),f.value.length===0){c.warning("请先完善简历信息"),A.push("/profile/resume");return}w.value=!0},N=async()=>{var s;if(!_.resumeId){c.warning("请选择简历");return}D.value=!0;try{const{data:e,error:i}=await y.from("students").select("id, real_name").eq("user_id",(s=b.user)==null?void 0:s.id).single();if(i)throw i;if(!e){c.error("请先完善个人信息");return}const{data:d,error:m}=await y.from("applications").select("id, status").eq("job_id",C.value).eq("student_id",e.id).single();if(m&&m.code!=="PGRST116")throw m;if(d){c.warning(`您已经申请过该岗位，当前状态：${d.status}`),w.value=!1,D.value=!1;return}const r=f.value.find(V=>V.id===_.resumeId),{data:j,error:S}=await y.from("applications").insert({job_id:C.value,student_id:e.id,cover_letter:_.message||"",resume_url:(r==null?void 0:r.url)||null,status:"pending",applied_at:new Date().toISOString()}).select().single();if(S)throw S;await R(j.id,e.real_name),c.success("申请提交成功！公司将会收到您的申请通知"),w.value=!1,o.value.applicationCount++,_.resumeId="",_.message=""}catch(e){console.error("申请提交失败:",e),c.error(e.message||"申请提交失败，请重试")}finally{D.value=!1}},R=async(s,e)=>{try{const{data:i}=await y.from("jobs").select("title, company_id").eq("id",C.value).single();if(!i)return;const{data:d}=await y.from("companies").select("company_name, user_id").eq("id",i.company_id).single();if(!d)return;console.log(`发送申请通知：学生 ${e} 申请了岗位 "${i.title}"`)}catch(i){console.warn("发送通知失败:",i)}},U=()=>{if(!b.isAuthenticated){c.warning("请先登录"),A.push("/login");return}h.value=!h.value,h.value?c.success("已添加到收藏"):c.info("已取消收藏")},H=async()=>{try{F.value=!0;const{data:s,error:e}=await y.from("jobs").select(`
        id,
        title,
        salary_range,
        work_location,
        description,
        created_at,
        company_id,
        work_hours,
        job_type,
        category,
        skills_required,
        recruit_count
      `).eq("id",C.value).single();if(e){console.error("加载岗位详情失败:",e),o.value=I();return}if(s){let i={name:"招聘公司",industry:"其他"};try{const{data:r}=await y.from("companies").select("company_name, industry").eq("id",s.company_id).single();r&&(i={name:r.company_name||"招聘公司",industry:r.industry||"其他"})}catch(r){console.warn("获取公司信息失败:",r)}let d=0;try{const{data:r}=await y.from("applications").select("id").eq("job_id",s.id);d=(r==null?void 0:r.length)||0}catch(r){console.warn("获取申请人数失败:",r)}const m=r=>{const j=new Date(r),V=new Date().getTime()-j.getTime(),k=Math.floor(V/(1e3*60*60));return k<1?"刚刚":k<24?`${k}小时前`:`${Math.floor(k/24)}天前`};o.value={id:s.id,title:s.title||"岗位标题",company:i.name,location:s.work_location||"工作地点待定",salary:s.salary_range||"面议",workTime:s.work_hours||"工作时间待定",recruitCount:s.recruit_count||1,applicationCount:d,publishTime:m(s.created_at),description:s.description||"暂无描述",requirements:s.skills_required?Array.isArray(s.skills_required)?s.skills_required:[s.skills_required]:[],tags:s.skills_required?Array.isArray(s.skills_required)?s.skills_required:[s.skills_required]:[],companyLogo:"",industry:i.industry,companySize:"",companyDescription:"",address:s.work_location||""}}else c.error("岗位不存在"),o.value=I()}catch(s){console.error("加载岗位详情失败:",s),c.error("加载岗位详情失败"),o.value=I()}finally{F.value=!1}},I=()=>({id:C.value,title:"前端开发实习生",company:"腾讯科技",location:"深圳·南山区",salary:"200-300元/天",workTime:"每周3-5天",recruitCount:5,applicationCount:0,publishTime:"2小时前",description:"负责公司产品的前端开发工作，参与需求讨论和技术方案设计。",requirements:["熟悉HTML/CSS/JavaScript","了解React或Vue框架","有良好的学习能力"],tags:["React","Vue","TypeScript"],companyLogo:"",industry:"互联网",companySize:"1000人以上",companyDescription:"腾讯是一家世界领先的互联网科技公司，专注于社交平台、数字内容、金融科技等领域。",address:"深圳市南山区科技园"});return Z(()=>{H()}),(s,e)=>{const i=p("el-icon"),d=p("el-button"),m=p("el-tag"),r=p("el-avatar"),j=p("el-empty"),S=p("el-card"),V=p("el-option"),k=p("el-select"),J=p("el-form-item"),G=p("el-input"),K=p("el-form"),O=p("el-dialog");return g(),T("div",ne,[t("div",ie,[t("div",re,[a(d,{onClick:e[0]||(e[0]=u=>s.$router.back()),type:"text"},{default:l(()=>[a(i,null,{default:l(()=>[a(x(se))]),_:1}),e[5]||(e[5]=v(" 返回 ",-1))]),_:1})]),a(S,{class:"job-card"},{header:l(()=>{var u;return[t("div",ue,[t("div",de,[t("h1",null,n(o.value.title),1),t("div",ce,[a(m,{type:"primary"},{default:l(()=>[v(n(o.value.company),1)]),_:1}),a(m,null,{default:l(()=>[v(n(o.value.location),1)]),_:1}),a(m,{type:"success"},{default:l(()=>[v(n(o.value.salary),1)]),_:1})])]),t("div",pe,[x(b).isAuthenticated&&((u=x(b).user)==null?void 0:u.role)==="student"?(g(),$(d,{key:0,type:"primary",size:"large",onClick:B,loading:D.value},{default:l(()=>[a(i,null,{default:l(()=>[a(x(oe))]),_:1}),e[6]||(e[6]=v(" 立即申请 ",-1))]),_:1},8,["loading"])):ae("",!0),a(d,{type:"info",size:"large",onClick:U},{default:l(()=>[a(i,{color:h.value?"#f56c6c":""},{default:l(()=>[v(n(h.value?"StarFilled":"Star"),1)]),_:1},8,["color"]),v(" "+n(h.value?"已收藏":"收藏"),1)]),_:1})])])]}),default:l(()=>[t("div",_e,[t("div",me,[e[13]||(e[13]=t("h3",null,"岗位信息",-1)),t("div",ve,[t("div",fe,[e[7]||(e[7]=t("span",{class:"label"},"工作地点：",-1)),t("span",ye,n(o.value.location),1)]),t("div",ge,[e[8]||(e[8]=t("span",{class:"label"},"薪资范围：",-1)),t("span",be,n(o.value.salary),1)]),t("div",we,[e[9]||(e[9]=t("span",{class:"label"},"工作时间：",-1)),t("span",he,n(o.value.workTime),1)]),t("div",ke,[e[10]||(e[10]=t("span",{class:"label"},"招聘人数：",-1)),t("span",qe,n(o.value.recruitCount)+"人",1)]),t("div",Ce,[e[11]||(e[11]=t("span",{class:"label"},"发布时间：",-1)),t("span",De,n(o.value.publishTime),1)]),t("div",je,[e[12]||(e[12]=t("span",{class:"label"},"申请人数：",-1)),t("span",Se,n(o.value.applicationCount)+"人",1)])])]),t("div",Ve,[e[14]||(e[14]=t("h3",null,"岗位描述",-1)),t("div",Te,n(o.value.description),1)]),t("div",xe,[e[15]||(e[15]=t("h3",null,"岗位要求",-1)),t("ul",Ae,[(g(!0),T(z,null,E(o.value.requirements,(u,P)=>(g(),T("li",{key:P},n(u),1))),128))])]),t("div",Ie,[e[16]||(e[16]=t("h3",null,"岗位标签",-1)),t("div",$e,[(g(!0),T(z,null,E(o.value.tags,u=>(g(),$(m,{key:u,type:"info",class:"tag-item"},{default:l(()=>[v(n(u),1)]),_:2},1024))),128))])]),t("div",ze,[e[17]||(e[17]=t("h3",null,"公司信息",-1)),t("div",Ee,[t("div",Fe,[a(r,{size:60,src:o.value.companyLogo},null,8,["src"]),t("div",Je,[t("h4",null,n(o.value.company),1),t("p",Le,n(o.value.industry),1),t("p",Me,"规模："+n(o.value.companySize),1)])]),t("p",Be,n(o.value.companyDescription),1)])]),t("div",Ne,[e[18]||(e[18]=t("h3",null,"工作地点",-1)),t("div",Re,[a(j,{description:"地图功能开发中"},{default:l(()=>[t("p",null,"地址："+n(o.value.address),1)]),_:1})])])])]),_:1}),a(O,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=u=>w.value=u),title:"申请岗位",width:"500px"},{footer:l(()=>[a(d,{onClick:e[3]||(e[3]=u=>w.value=!1)},{default:l(()=>[...e[19]||(e[19]=[v("取消",-1)])]),_:1}),a(d,{type:"primary",onClick:N,loading:D.value},{default:l(()=>[...e[20]||(e[20]=[v(" 提交申请 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(K,{model:_,"label-width":"80px"},{default:l(()=>[a(J,{label:"简历"},{default:l(()=>[a(k,{modelValue:_.resumeId,"onUpdate:modelValue":e[1]||(e[1]=u=>_.resumeId=u),placeholder:"选择简历",style:{width:"100%"}},{default:l(()=>[(g(!0),T(z,null,E(f.value,u=>(g(),$(V,{key:u.id,label:u.title,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(J,{label:"申请说明"},{default:l(()=>[a(G,{modelValue:_.message,"onUpdate:modelValue":e[2]||(e[2]=u=>_.message=u),type:"textarea",rows:3,placeholder:"请输入申请说明（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])])}}});const Ke=le(Ue,[["__scopeId","data-v-d3b7dc03"]]);export{Ke as default};
