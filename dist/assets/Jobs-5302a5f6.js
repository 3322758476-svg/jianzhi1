import{d as ce,u as pe,r as f,B as Q,C as me,o as _e,c as I,a as n,b as a,w as u,D as ve,F as E,e as B,h as fe,s as y,E as v,i as m,k as V,l as $,m as ye,n as h,p as F,t as _,G as W,y as ge,A as he,H as be,q as we,I as ke,_ as Ve}from"./index-d856f604.js";const Ce={class:"jobs-container"},xe={class:"search-section"},Te={class:"search-bar"},qe={class:"filter-section"},Ie={class:"filter-group"},$e={class:"filter-group"},Se={class:"filter-group"},Ue={class:"filter-group"},Me={class:"filter-group"},ze={class:"filter-group"},De={class:"jobs-content"},Ae={class:"jobs-header"},Je={class:"sort-options"},Ee={class:"jobs-list"},Be={class:"job-header"},Fe={class:"job-title-section"},Le={class:"job-title"},Ne={class:"job-actions"},Re={class:"job-info"},Pe={class:"company-info"},He={class:"company-details"},Ke={class:"company-name"},Ge={class:"company-industry"},Oe={class:"job-details"},Qe={class:"detail-item"},We={class:"detail-item"},Xe={class:"detail-item"},Ye={class:"job-description"},Ze={class:"job-footer"},je={class:"job-tags"},ea={class:"publish-time"},aa={class:"pagination-section"},la={key:0},ta=ce({__name:"Jobs",setup(sa){const L=fe(),z=pe(),C=f(""),d=Q({location:"",salary:"",type:"",industry:"",education:"",experience:""}),S=f(!1),D=f("time"),A=f(1),N=f(10),w=f(0),x=f(!1),k=f(null),g=Q({resumeId:"",message:""}),p=f([]),b=f([]),U=f([]),X=async()=>{var t;try{b.value=[];const{data:e,error:i}=await y.from("students").select("id, real_name, resume_url").eq("user_id",(t=z.user)==null?void 0:t.id).single();if(i){console.warn("获取学生信息失败，使用默认简历选项:",i),b.value=[{id:"text_resume",title:"文本简历",url:null}];return}e?(e.resume_url&&b.value.push({id:"uploaded_resume",title:`${e.real_name||"我的"}简历文件`,url:e.resume_url}),b.value.push({id:"text_resume",title:"文本简历",url:null})):b.value=[{id:"text_resume",title:"文本简历",url:null}]}catch(e){console.error("加载简历数据失败:",e),b.value=[{id:"text_resume",title:"文本简历",url:null}]}},Y=async()=>{try{S.value=!0;const{data:t,error:e}=await y.from("jobs").select(`
        id,
        title,
        salary_range,
        work_location,
        description,
        created_at,
        company_id,
        work_hours,
        job_type,
        category,
        skills_required
      `).eq("status","active").order("created_at",{ascending:!1});if(e){console.error("加载职位数据失败:",e),p.value=M(),w.value=p.value.length;return}if(t&&t.length>0){let i=new Map;try{const o=[...new Set(t.map(l=>l.company_id))],{data:r}=await y.from("companies").select("id, company_name, industry").in("id",o);i=new Map((r==null?void 0:r.map(l=>[l.id,{name:l.company_name,industry:l.industry}]))||[])}catch(o){console.warn("获取公司信息失败，使用默认公司名:",o)}p.value=t.map(o=>{const r=i.get(o.company_id)||{name:"招聘公司",industry:"其他"},l=o.skills_required||[];return{id:o.id,title:o.title,salary:o.salary_range||"面议",location:o.work_location||"工作地点待定",workTime:o.work_hours||"工作时间待定",recruitCount:1,description:o.description,publishTime:R(o.created_at),company:{name:r.name,logo:"",industry:r.industry},tags:Array.isArray(l)?l:[l]}}),w.value=p.value.length}else p.value=M(),w.value=p.value.length}catch(t){console.error("加载职位数据失败:",t),v.error("加载职位失败"),p.value=M(),w.value=p.value.length}finally{S.value=!1}},M=()=>[{id:"1",title:"前端开发实习生",salary:"200-300元/天",location:"深圳·南山区",workTime:"每周3-5天",recruitCount:5,description:"负责公司产品的前端开发工作，参与需求讨论和技术方案设计。",publishTime:"2小时前",company:{name:"腾讯科技",logo:"",industry:"互联网"},tags:["React","Vue","TypeScript"]},{id:"2",title:"新媒体运营助理",salary:"150-200元/天",location:"北京·海淀区",workTime:"每周4天",recruitCount:3,description:"负责社交媒体内容创作和运营，协助品牌推广活动。",publishTime:"1天前",company:{name:"字节跳动",logo:"",industry:"互联网"},tags:["新媒体","内容运营","社交媒体"]}],R=t=>{const e=new Date(t),o=new Date().getTime()-e.getTime(),r=Math.floor(o/6e4),l=Math.floor(o/36e5),c=Math.floor(o/864e5);return r<60?`${r}分钟前`:l<24?`${l}小时前`:`${c}天前`},Z=me(()=>{let t=p.value;if(C.value){const e=C.value.toLowerCase();t=t.filter(i=>i.title.toLowerCase().includes(e)||i.company.name.toLowerCase().includes(e)||i.tags.some(o=>o.toLowerCase().includes(e)))}return d.location&&(t=t.filter(e=>d.location==="remote"?e.location==="远程":e.location.includes(d.location))),d.salary&&(t=t.filter(e=>{const i=e.salary;switch(d.salary){case"0-100":return i.includes("100元/天以下");case"100-200":return i.includes("100-200");case"200-300":return i.includes("200-300");case"300+":return i.includes("300元/天以上");default:return!0}})),d.type&&(t=t.filter(e=>e.workTime.includes(d.type))),d.industry&&(t=t.filter(e=>e.company.industry===d.industry)),t.sort((e,i)=>{switch(D.value){case"salary":return H(i.salary)-H(e.salary);case"hot":return i.recruitCount-e.recruitCount;default:return 0}}),t}),P=async()=>{try{S.value=!0;let t=y.from("jobs").select(`
        id,
        title,
        salary_range,
        work_location,
        description,
        created_at,
        company_id,
        work_hours,
        job_type,
        category,
        skills_required
      `).eq("status","active").order("created_at",{ascending:!1});if(C.value.trim()){const o=C.value.trim();t=t.or(`title.ilike.%${o}%,description.ilike.%${o}%`)}if(d.location&&(t=t.eq("work_location",d.location)),d.salary&&(t=t.eq("salary_range",d.salary)),d.type&&(t=t.eq("job_type",d.type)),d.industry){const{data:o}=await y.from("companies").select("id").eq("industry",d.industry);if(o&&o.length>0){const r=o.map(l=>l.id);t=t.in("company_id",r)}}const{data:e,error:i}=await t;if(i)throw i;if(e&&e.length>0){let o=new Map;try{const r=[...new Set(e.map(c=>c.company_id))],{data:l}=await y.from("companies").select("id, company_name, industry").in("id",r);o=new Map((l==null?void 0:l.map(c=>[c.id,{name:c.company_name,industry:c.industry}]))||[])}catch(r){console.warn("获取公司信息失败，使用默认公司名:",r)}p.value=e.map(r=>{const l=o.get(r.company_id)||{name:"招聘公司",industry:"其他"},c=r.skills_required||[];return{id:r.id,title:r.title,salary:r.salary_range||"面议",location:r.work_location||"工作地点待定",workTime:r.work_hours||"工作时间待定",recruitCount:1,description:r.description,publishTime:R(r.created_at),company:{name:l.name,logo:"",industry:l.industry},tags:Array.isArray(c)?c:[c]}}),w.value=p.value.length,v.success(`找到 ${p.value.length} 个相关岗位`)}else p.value=[],w.value=0,v.info("未找到相关岗位")}catch(t){console.error("搜索失败:",t),v.error("搜索失败，请稍后重试"),p.value=M(),w.value=p.value.length}finally{S.value=!1}},j=()=>{},ee=t=>{A.value=t},ae=t=>t.includes("300")?"danger":t.includes("200")?"warning":"success",H=t=>{const e=t.match(/\d+/g);return e?parseInt(e[0]):0},K=t=>U.value.includes(t),le=t=>{const e=U.value.indexOf(t.id);e>-1?(U.value.splice(e,1),v.success("已取消收藏")):(U.value.push(t.id),v.success("收藏成功"))},te=async t=>{if(!z.isAuthenticated){v.warning("请先登录"),L.push("/login");return}if(await X(),b.value.length===0){v.warning("请先完善简历信息"),L.push("/profile/resume");return}k.value=t,x.value=!0},se=async()=>{var t;if(!g.resumeId){v.warning("请选择简历");return}try{const{data:e,error:i}=await y.from("students").select("id, real_name").eq("user_id",(t=z.user)==null?void 0:t.id).single();if(i)throw i;if(!e){v.error("请先完善个人信息");return}const{data:o,error:r}=await y.from("applications").select("id, status").eq("job_id",k.value.id).eq("student_id",e.id).single();if(r&&r.code!=="PGRST116")throw r;if(o){v.warning(`您已经申请过该岗位，当前状态：${o.status}`),x.value=!1;return}const l=b.value.find(J=>J.id===g.resumeId),{data:c,error:T}=await y.from("applications").insert({job_id:k.value.id,student_id:e.id,cover_letter:g.message||"",resume_url:(l==null?void 0:l.url)||null,status:"pending",applied_at:new Date().toISOString()}).select().single();if(T)throw T;await oe(c.id,e.real_name,k.value.id),v.success("申请提交成功！公司将会收到您的申请通知"),x.value=!1,g.resumeId="",g.message=""}catch(e){console.error("申请提交失败:",e),v.error(e.message||"申请提交失败，请重试")}},oe=async(t,e,i)=>{try{const{data:o}=await y.from("jobs").select("title, company_id").eq("id",i).single();if(!o)return;const{data:r}=await y.from("companies").select("company_name, user_id").eq("id",o.company_id).single();if(!r)return;console.log(`发送申请通知：学生 ${e} 申请了岗位 "${o.title}"`)}catch(o){console.warn("发送通知失败:",o)}};return _e(()=>{Y()}),(t,e)=>{const i=m("el-icon"),o=m("el-button"),r=m("el-input"),l=m("el-option"),c=m("el-select"),T=m("el-radio"),J=m("el-radio-group"),G=m("el-tag"),ne=m("el-avatar"),re=m("el-card"),ie=m("el-pagination"),O=m("el-form-item"),ue=m("el-form"),de=m("el-dialog");return V(),I("div",Ce,[n("div",xe,[n("div",Te,[a(r,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=s=>C.value=s),placeholder:"搜索兼职岗位、公司名称或关键词",size:"large",onKeyup:ve(P,["enter"])},{append:u(()=>[a(o,{type:"primary",onClick:P},{default:u(()=>[a(i,null,{default:u(()=>[a($(ye))]),_:1}),e[14]||(e[14]=h(" 搜索 ",-1))]),_:1})]),_:1},8,["modelValue"])]),n("div",qe,[n("div",Ie,[e[15]||(e[15]=n("span",{class:"filter-label"},"工作地点：",-1)),a(c,{modelValue:d.location,"onUpdate:modelValue":e[1]||(e[1]=s=>d.location=s),placeholder:"选择地点",clearable:"",filterable:""},{default:u(()=>[a(l,{label:"北京",value:"beijing"}),a(l,{label:"上海",value:"shanghai"}),a(l,{label:"广州",value:"guangzhou"}),a(l,{label:"深圳",value:"shenzhen"}),a(l,{label:"杭州",value:"hangzhou"}),a(l,{label:"成都",value:"chengdu"}),a(l,{label:"武汉",value:"wuhan"}),a(l,{label:"西安",value:"xian"}),a(l,{label:"远程",value:"remote"})]),_:1},8,["modelValue"])]),n("div",$e,[e[16]||(e[16]=n("span",{class:"filter-label"},"薪资范围：",-1)),a(c,{modelValue:d.salary,"onUpdate:modelValue":e[2]||(e[2]=s=>d.salary=s),placeholder:"选择薪资",clearable:""},{default:u(()=>[a(l,{label:"100元/天以下",value:"0-100"}),a(l,{label:"100-200元/天",value:"100-200"}),a(l,{label:"200-300元/天",value:"200-300"}),a(l,{label:"300-400元/天",value:"300-400"}),a(l,{label:"400元/天以上",value:"400+"})]),_:1},8,["modelValue"])]),n("div",Se,[e[17]||(e[17]=n("span",{class:"filter-label"},"工作类型：",-1)),a(c,{modelValue:d.type,"onUpdate:modelValue":e[3]||(e[3]=s=>d.type=s),placeholder:"选择类型",clearable:""},{default:u(()=>[a(l,{label:"长期兼职",value:"long-term"}),a(l,{label:"短期兼职",value:"short-term"}),a(l,{label:"实习",value:"internship"}),a(l,{label:"项目制",value:"project"}),a(l,{label:"周末兼职",value:"weekend"}),a(l,{label:"寒暑假",value:"vacation"})]),_:1},8,["modelValue"])]),n("div",Ue,[e[18]||(e[18]=n("span",{class:"filter-label"},"行业分类：",-1)),a(c,{modelValue:d.industry,"onUpdate:modelValue":e[4]||(e[4]=s=>d.industry=s),placeholder:"选择行业",clearable:""},{default:u(()=>[a(l,{label:"互联网/科技",value:"internet"}),a(l,{label:"教育/培训",value:"education"}),a(l,{label:"金融/保险",value:"finance"}),a(l,{label:"零售/电商",value:"retail"}),a(l,{label:"文化/传媒",value:"media"}),a(l,{label:"餐饮/服务",value:"catering"}),a(l,{label:"医疗/健康",value:"medical"}),a(l,{label:"制造/工业",value:"manufacturing"})]),_:1},8,["modelValue"])]),n("div",Me,[e[19]||(e[19]=n("span",{class:"filter-label"},"学历要求：",-1)),a(c,{modelValue:d.education,"onUpdate:modelValue":e[5]||(e[5]=s=>d.education=s),placeholder:"学历要求",clearable:""},{default:u(()=>[a(l,{label:"不限",value:"any"}),a(l,{label:"大专",value:"college"}),a(l,{label:"本科",value:"bachelor"}),a(l,{label:"硕士",value:"master"}),a(l,{label:"博士",value:"doctor"})]),_:1},8,["modelValue"])]),n("div",ze,[e[20]||(e[20]=n("span",{class:"filter-label"},"工作经验：",-1)),a(c,{modelValue:d.experience,"onUpdate:modelValue":e[6]||(e[6]=s=>d.experience=s),placeholder:"经验要求",clearable:""},{default:u(()=>[a(l,{label:"不限",value:"any"}),a(l,{label:"无经验",value:"no-experience"}),a(l,{label:"1年以下",value:"0-1"}),a(l,{label:"1-3年",value:"1-3"}),a(l,{label:"3年以上",value:"3+"})]),_:1},8,["modelValue"])])])]),n("div",De,[n("div",Ae,[e[24]||(e[24]=n("h2",null,"推荐兼职岗位",-1)),n("div",Je,[a(J,{modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=s=>D.value=s),onChange:j},{default:u(()=>[a(T,{label:"time"},{default:u(()=>[...e[21]||(e[21]=[h("最新发布",-1)])]),_:1}),a(T,{label:"salary"},{default:u(()=>[...e[22]||(e[22]=[h("薪资最高",-1)])]),_:1}),a(T,{label:"hot"},{default:u(()=>[...e[23]||(e[23]=[h("最受欢迎",-1)])]),_:1})]),_:1},8,["modelValue"])])]),n("div",Ee,[(V(!0),I(E,null,B(Z.value,s=>(V(),F(re,{key:s.id,class:"job-card",shadow:"hover",onClick:q=>t.$router.push(`/jobs/${s.id}`)},{default:u(()=>[n("div",Be,[n("div",Fe,[n("h3",Le,_(s.title),1),a(G,{type:ae(s.salary),size:"small"},{default:u(()=>[h(_(s.salary),1)]),_:2},1032,["type"])]),n("div",Ne,[a(o,{type:"primary",size:"small",onClick:W(q=>te(s),["stop"])},{default:u(()=>[...e[25]||(e[25]=[h(" 立即申请 ",-1)])]),_:1},8,["onClick"]),a(o,{type:K(s.id)?"danger":"default",size:"small",onClick:W(q=>le(s),["stop"])},{default:u(()=>[a(i,null,{default:u(()=>[a($(ge))]),_:1}),h(" "+_(K(s.id)?"已收藏":"收藏"),1)]),_:2},1032,["type","onClick"])])]),n("div",Re,[n("div",Pe,[a(ne,{size:40,src:s.company.logo},null,8,["src"]),n("div",He,[n("div",Ke,_(s.company.name),1),n("div",Ge,_(s.company.industry),1)])]),n("div",Oe,[n("div",Qe,[a(i,null,{default:u(()=>[a($(he))]),_:1}),n("span",null,_(s.location),1)]),n("div",We,[a(i,null,{default:u(()=>[a($(be))]),_:1}),n("span",null,_(s.workTime),1)]),n("div",Xe,[a(i,null,{default:u(()=>[a($(we))]),_:1}),n("span",null,_(s.recruitCount)+"人",1)])])]),n("div",Ye,_(s.description),1),n("div",Ze,[n("div",je,[(V(!0),I(E,null,B(s.tags,q=>(V(),F(G,{key:q,size:"small",type:"info"},{default:u(()=>[h(_(q),1)]),_:2},1024))),128))]),n("div",ea,_(s.publishTime),1)])]),_:2},1032,["onClick"]))),128))]),n("div",aa,[a(ie,{"current-page":A.value,"onUpdate:currentPage":e[8]||(e[8]=s=>A.value=s),"page-size":N.value,"onUpdate:pageSize":e[9]||(e[9]=s=>N.value=s),total:w.value,layout:"prev, pager, next, jumper",onCurrentChange:ee},null,8,["current-page","page-size","total"])])]),a(de,{modelValue:x.value,"onUpdate:modelValue":e[13]||(e[13]=s=>x.value=s),title:"申请岗位",width:"500px"},{footer:u(()=>[a(o,{onClick:e[12]||(e[12]=s=>x.value=!1)},{default:u(()=>[...e[26]||(e[26]=[h("取消",-1)])]),_:1}),a(o,{type:"primary",onClick:se},{default:u(()=>[...e[27]||(e[27]=[h("确认申请",-1)])]),_:1})]),default:u(()=>[k.value?(V(),I("div",la,[n("h4",null,_(k.value.title),1),n("p",null,"公司："+_(k.value.company.name),1),n("p",null,"薪资："+_(k.value.salary),1),a(ue,{model:g,"label-width":"80px"},{default:u(()=>[a(O,{label:"简历"},{default:u(()=>[a(c,{modelValue:g.resumeId,"onUpdate:modelValue":e[10]||(e[10]=s=>g.resumeId=s),placeholder:"选择简历"},{default:u(()=>[(V(!0),I(E,null,B(b.value,s=>(V(),F(l,{key:s.id,label:s.title,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(O,{label:"留言"},{default:u(()=>[a(r,{modelValue:g.message,"onUpdate:modelValue":e[11]||(e[11]=s=>g.message=s),type:"textarea",placeholder:"给HR的留言（可选）",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):ke("",!0)]),_:1},8,["modelValue"])])}}});const na=Ve(ta,[["__scopeId","data-v-745795d6"]]);export{na as default};
