import{d as Z,s as g,r as h,o as j,c,a as o,b as d,w as r,E as _,i as f,k as i,n as p,F as w,e as b,P as O,p as k,Z as G,t as y,I,$ as x,V as L,O as R,a0 as Y,q,a1 as U,_ as X}from"./index-d856f604.js";const Q={class:"notifications-page"},H={class:"notifications-container"},K={class:"card-header"},P={class:"header-actions"},W={class:"notifications-content"},ee={key:0,class:"loading-container"},te={key:1,class:"empty-state"},se={key:2,class:"notifications-list"},oe={class:"notification-icon"},ae={class:"notification-content"},ne={class:"notification-header"},ie={class:"notification-title"},le={class:"notification-time"},ce={class:"notification-message"},re={key:0,class:"notification-actions"},de={class:"notification-actions-right"},ue=Z({__name:"Notifications",setup(_e){console.log("Supabase 配置:",{url:"https://wptvwhlazelotraoagwt.supabase.co",key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndwdHZ3aGxhemVsb3RyYW9hZ3d0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExNTkxNzYsImV4cCI6MjA3NjczNTE3Nn0.kiyMw30CVO5GKxqyFi4zC73LiMha5g8v-iopV44VQGo"}),console.log("Supabase 客户端初始化状态:",g?"成功":"失败");const l=h([]),v=h(!1),C=h(0),z=async()=>{const{data:{user:t}}=await g.auth.getUser();if(!t)return console.error("用户未登录"),[];console.log("当前用户ID:",t.id);const{data:e,error:a}=await g.from("notifications").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(a)throw console.error("获取通知数据失败:",a),console.error("错误详情:",a.message),a;return console.log("获取到的通知数据:",e),e?e.map(s=>({id:s.id,title:s.title,message:s.description||s.title,type:s.type,read:s.read,time:s.created_at,actions:[]})):(console.log("没有找到通知数据"),[])},m=()=>{C.value=l.value.filter(t=>!t.read).length},E=t=>({system:R,job:x,message:Y,user:q,setting:U})[t]||x,V=t=>({system:"#409EFF",application:"#67C23A",recommendation:"#E6A23C",interview:"#F56C6C",result:"#909399"})[t]||"#409EFF",F=t=>{const e=new Date(t),s=new Date().getTime()-e.getTime();return s<6e4?"刚刚":s<36e5?`${Math.floor(s/6e4)}分钟前`:s<864e5?`${Math.floor(s/36e5)}小时前`:s<6048e5?`${Math.floor(s/864e5)}天前`:e.toLocaleDateString()},N=async()=>{v.value=!0;try{l.value=await z(),m()}catch{_.error("加载通知失败")}finally{v.value=!1}},M=async t=>{const e=l.value.find(a=>a.id===t);e&&(e.read=!0,m(),_.success("标记为已读成功"))},B=async()=>{l.value.forEach(t=>{t.read=!0}),m(),_.success("全部标记为已读成功")},T=async t=>{try{await L.confirm("确定要删除这条通知吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),l.value=l.value.filter(e=>e.id!==t),m(),_.success("删除成功")}catch{}},$=(t,e)=>{_.info(`执行操作: ${e.label}`),console.log("处理通知:",t,"操作:",e)},A=()=>{N()};return j(()=>{N()}),(t,e)=>{const a=f("el-button"),s=f("el-skeleton"),J=f("el-empty"),D=f("el-icon"),S=f("el-card");return i(),c("div",Q,[e[5]||(e[5]=o("div",{class:"page-header"},[o("h2",null,"通知中心"),o("p",null,"查看和管理您的系统通知")],-1)),o("div",H,[d(S,{class:"notifications-card"},{header:r(()=>[o("div",K,[e[2]||(e[2]=o("span",null,"通知列表",-1)),o("div",P,[d(a,{type:"primary",onClick:A},{default:r(()=>[...e[0]||(e[0]=[p("刷新",-1)])]),_:1}),d(a,{onClick:B,disabled:C.value===0},{default:r(()=>[...e[1]||(e[1]=[p("全部标记为已读",-1)])]),_:1},8,["disabled"])])])]),default:r(()=>[o("div",W,[v.value?(i(),c("div",ee,[d(s,{rows:5,animated:""})])):l.value.length===0?(i(),c("div",te,[d(J,{description:"暂无通知"})])):(i(),c("div",se,[(i(!0),c(w,null,b(l.value,n=>(i(),c("div",{key:n.id,class:O(["notification-item",{unread:!n.read}])},[o("div",oe,[d(D,{color:V(n.type)},{default:r(()=>[(i(),k(G(E(n.type))))]),_:2},1032,["color"])]),o("div",ae,[o("div",ne,[o("span",ie,y(n.title),1),o("span",le,y(F(n.time)),1)]),o("div",ce,y(n.message),1),n.actions?(i(),c("div",re,[(i(!0),c(w,null,b(n.actions,u=>(i(),k(a,{key:u.label,type:u.type,size:"small",onClick:fe=>$(n,u)},{default:r(()=>[p(y(u.label),1)]),_:2},1032,["type","onClick"]))),128))])):I("",!0)]),o("div",de,[n.read?I("",!0):(i(),k(a,{key:0,type:"text",size:"small",onClick:u=>M(n.id)},{default:r(()=>[...e[3]||(e[3]=[p(" 标记已读 ",-1)])]),_:1},8,["onClick"])),d(a,{type:"text",size:"small",onClick:u=>T(n.id)},{default:r(()=>[...e[4]||(e[4]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])])],2))),128))]))])]),_:1})])])}}});const me=X(ue,[["__scopeId","data-v-eb09d5a1"]]);export{me as default};
