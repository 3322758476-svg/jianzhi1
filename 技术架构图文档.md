# 校园职通 - 技术架构图文档

## 系统整体架构图

### 1. 总体架构概览

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户访问层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│    Web前端       │   移动端App      │     第三方集成             │
│                 │                │                           │
│ Vue 3 + TS      │ React Native    │   微信小程序              │
│ Element Plus    │   原生组件      │   企业微信                │
│ PWA支持         │   推送通知      │   钉钉集成                │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        API网关层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  负载均衡器      │   API网关       │     认证服务              │
│                 │                │                           │
│ Nginx          │  路由分发      │   JWT令牌验证             │
│ 限流控制        │  请求过滤      │   权限校验                │
│ 缓存策略        │  日志记录      │   频率限制                │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       业务服务层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  用户服务        │  岗位服务       │     消息服务              │
│                 │                │                           │
│ 认证管理        │  岗位管理      │   实时聊天               │
│ 个人中心        │  申请管理      │   通知系统               │
│ 权限控制        │  搜索服务      │   邮件服务               │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       数据访问层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  Repository层   │   缓存层        │     消息队列              │
│                 │                │                           │
│ 数据抽象        │  Redis缓存     │   RabbitMQ               │
│ 业务逻辑        │  本地缓存      │   异步任务               │
│ 事务管理        │  分布式锁      │   削峰填谷               │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       数据存储层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  关系数据库      │  文档数据库     │     文件存储              │
│                 │                │                           │
│ PostgreSQL     │  MongoDB      │   Supabase Storage       │
│ 主从复制        │  日志存储      │   CDN加速                │
│ 读写分离        │  分析数据      │   备份恢复               │
└─────────────────┴─────────────────┴───────────────────────────┘
```

## 前端架构详细设计

### 1. 前端技术栈架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        应用层                                   │
├─────────────────┬─────────────────┬───────────────────────────┤
│   页面组件       │   路由管理       │     状态管理               │
│                 │                │                           │
│ 业务页面        │  Vue Router    │   Pinia Store             │
│ 布局组件        │  路由守卫      │   模块化状态               │
│ 公共组件        │  懒加载        │   持久化存储               │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        UI组件层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  基础组件库      │  业务组件库      │     样式系统              │
│                 │                │                           │
│ Element Plus   │  自定义组件      │   SCSS变量系统            │
│ 表单组件        │  复合组件      │   主题配置                │
│ 数据展示        │  图表组件      │   响应式设计              │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       工具层                                   │
├─────────────────┬─────────────────┬───────────────────────────┤
│  工具函数        │   HTTP客户端    │     类型定义              │
│                 │                │                           │
│ 工具类库        │  Axios封装     │   TypeScript类型          │
│ 日期处理        │  拦截器        │   接口类型                │
│ 数据格式化      │  错误处理      │   枚举定义                │
└─────────────────┴─────────────────┴───────────────────────────┘
```

### 2. 前端目录结构

```
src/
├── main.ts                    # 应用入口
├── App.vue                    # 根组件
├── index.html                 # HTML模板
│
├── components/                # 组件目录
│   ├── common/               # 通用组件
│   │   ├── Layout/          # 布局组件
│   │   ├── Navigation/       # 导航组件
│   │   ├── Form/            # 表单组件
│   │   └── Table/           # 表格组件
│   ├── business/            # 业务组件
│   │   ├── JobCard/         # 岗位卡片
│   │   ├── ApplicationForm/ # 申请表单
│   │   └── MessageList/     # 消息列表
│   └── ui/                  # UI组件
│       ├── Button/          # 按钮组件
│       ├── Modal/           # 模态框
│       └── Loading/         # 加载组件
│
├── views/                    # 页面组件
│   ├── auth/                # 认证页面
│   │   ├── Login.vue        # 登录页面
│   │   ├── Register.vue     # 注册页面
│   │   └── ForgotPassword.vue
│   ├── jobs/                # 岗位页面
│   │   ├── JobList.vue      # 岗位列表
│   │   ├── JobDetail.vue    # 岗位详情
│   │   └── JobSearch.vue    # 岗位搜索
│   ├── profile/             # 个人中心
│   │   ├── StudentProfile.vue
│   │   ├── CompanyProfile.vue
│   │   └── Settings.vue
│   └── messages/           # 消息页面
│       ├── ChatList.vue    # 聊天列表
│       └── ChatRoom.vue    # 聊天室
│
├── store/                   # 状态管理
│   ├── modules/            # 状态模块
│   │   ├── user.ts        # 用户状态
│   │   ├── jobs.ts        # 岗位状态
│   │   ├── messages.ts    # 消息状态
│   │   └── applications.ts # 申请状态
│   └── index.ts           # 状态主文件
│
├── router/                 # 路由配置
│   ├── index.ts           # 路由配置
│   ├── routes/            # 路由定义
│   └── guards/            # 路由守卫
│
├── api/                   # API接口
│   ├── index.ts           # API主文件
│   ├── auth.ts           # 认证接口
│   ├── jobs.ts           # 岗位接口
│   ├── messages.ts       # 消息接口
│   └── types/            # 接口类型
│
├── utils/                 # 工具函数
│   ├── request.ts        # 请求封装
│   ├── storage.ts        # 存储工具
│   ├── validate.ts       # 验证工具
│   └── constants.ts      # 常量定义
│
├── types/                 # 类型定义
│   ├── global.d.ts       # 全局类型
│   ├── api.ts           # API类型
│   ├── store.ts          # 状态类型
│   └── component.ts      # 组件类型
│
├── assets/                # 静态资源
│   ├── images/           # 图片资源
│   ├── styles/           # 样式文件
│   └── icons/            # 图标资源
│
└── hooks/                # 组合式函数
    ├── useAuth.ts       # 认证相关
    ├── useJobs.ts       # 岗位相关
    ├── useMessages.ts   # 消息相关
    └── useApplications.ts # 申请相关
```

## 后端架构详细设计

### 1. Supabase 服务架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        Supabase 云服务                           │
├─────────────────┬─────────────────┬───────────────────────────┤
│  认证服务        │  数据库服务      │     存储服务              │
│                 │                │                           │
│ 用户注册        │  PostgreSQL   │   文件上传                │
│ 登录验证        │  实时订阅      │   图片处理                │
│ 第三方登录      │  SQL编辑器     │   CDN分发                │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       数据库设计                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  核心业务表      │  关联关系表      │     系统表                │
│                 │                │                           │
│ profiles       │  applications  │   audit_logs             │
│ students       │  messages      │   system_config          │
│ companies      │  reviews       │   notification_templates │
│ jobs           │  favorites     │   error_logs             │
└─────────────────┴─────────────────┴───────────────────────────┘
```

### 2. 数据库表结构设计

#### 核心业务表

```sql
-- 用户档案表（主表）
CREATE TABLE profiles (
    id UUID PRIMARY KEY REFERENCES auth.users(id),
    username VARCHAR(50) NOT NULL,
    avatar_url VARCHAR(255),
    role VARCHAR(20) CHECK (role IN ('student', 'company', 'admin')),
    email VARCHAR(100) NOT NULL,
    phone VARCHAR(20),
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    last_login_at TIMESTAMP WITH TIME ZONE
);

-- 学生信息表
CREATE TABLE students (
    id UUID PRIMARY KEY REFERENCES profiles(id),
    student_id VARCHAR(20) UNIQUE NOT NULL,
    real_name VARCHAR(50) NOT NULL,
    school VARCHAR(100) NOT NULL,
    major VARCHAR(100),
    grade VARCHAR(20),
    skills TEXT[],
    experience TEXT,
    resume_url VARCHAR(255),
    expected_salary VARCHAR(50),
    preferred_locations TEXT[],
    is_verified BOOLEAN DEFAULT FALSE,
    verification_date TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 企业信息表
CREATE TABLE companies (
    id UUID PRIMARY KEY REFERENCES profiles(id),
    company_name VARCHAR(100) NOT NULL,
    industry VARCHAR(50),
    scale VARCHAR(20),
    address TEXT,
    description TEXT,
    contact_person VARCHAR(50),
    contact_phone VARCHAR(20),
    business_license VARCHAR(255),
    is_verified BOOLEAN DEFAULT FALSE,
    verification_date TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 兼职岗位表
CREATE TABLE jobs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    company_id UUID NOT NULL REFERENCES companies(id),
    title VARCHAR(200) NOT NULL,
    description TEXT NOT NULL,
    salary_range VARCHAR(50) NOT NULL,
    location VARCHAR(100) NOT NULL,
    work_type VARCHAR(20) NOT NULL,
    category VARCHAR(50),
    requirements TEXT,
    benefits TEXT,
    application_count INTEGER DEFAULT 0,
    view_count INTEGER DEFAULT 0,
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'filled')),
    publish_date TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    expiry_date TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 岗位申请表
CREATE TABLE applications (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    job_id UUID NOT NULL REFERENCES jobs(id),
    student_id UUID NOT NULL REFERENCES students(id),
    status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'reviewing', 'accepted', 'rejected')),
    cover_letter TEXT,
    application_date TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    reviewed_at TIMESTAMP WITH TIME ZONE,
    review_notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 实时消息表
CREATE TABLE messages (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    conversation_id UUID NOT NULL,
    sender_id UUID NOT NULL REFERENCES profiles(id),
    receiver_id UUID NOT NULL REFERENCES profiles(id),
    content TEXT NOT NULL,
    message_type VARCHAR(20) DEFAULT 'text' CHECK (message_type IN ('text', 'file', 'system')),
    file_url VARCHAR(255),
    file_name VARCHAR(255),
    file_size INTEGER,
    is_read BOOLEAN DEFAULT FALSE,
    read_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 双向评价表
CREATE TABLE reviews (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    reviewer_id UUID NOT NULL REFERENCES profiles(id),
    reviewed_id UUID NOT NULL REFERENCES profiles(id),
    job_id UUID REFERENCES jobs(id),
    rating INTEGER NOT NULL CHECK (rating >= 1 AND rating <= 5),
    comment TEXT,
    review_type VARCHAR(20) NOT NULL CHECK (review_type IN ('student_to_company', 'company_to_student')),
    is_anonymous BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## 部署架构设计

### 1. 生产环境部署架构

```
┌─────────────────────────────────────────────────────────────────┐
│                       用户访问层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  域名解析        │   CDN加速       │     安全防护              │
│                 │                │                           │
│ Cloudflare DNS │  全球CDN       │   WAF防火墙              │
│ 负载均衡        │  静态资源       │   DDoS防护               │
│ 健康检查        │  缓存策略       │   安全扫描                │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       前端部署层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  Vercel部署      │  静态资源        │     PWA支持               │
│                 │                │                           │
│ 自动部署        │  代码分割       │   离线缓存                │
│ 环境变量        │  预渲染         │   推送通知                │
│ 性能监控        │  错误追踪       │   安装提示                │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       Supabase后端                              │
├─────────────────┬─────────────────┬───────────────────────────┤
│  数据库服务      │  认证服务        │     存储服务              │
│                 │                │                           │
│ 主从复制        │  OAuth集成      │   文件存储                │
│ 自动备份        │  多因素认证     │   图片处理                │
│ 性能监控        │  安全审计       │   版本控制                │
└─────────────────┴─────────────────┴───────────────────────────┘
```

### 2. 监控与告警架构

```
┌─────────────────────────────────────────────────────────────────┐
│                       监控数据采集                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  前端监控        │  后端监控        │     业务监控              │
│                 │                │                           │
│ Sentry错误监控  │  New Relic     │   自定义指标              │
│ 性能指标        │  APM监控       │   关键业务流程            │
│ 用户行为        │  数据库监控     │   转化率统计              │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       数据处理层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  数据聚合        │  数据分析        │     可视化展示            │
│                 │                │                           │
│ 时序数据库      │  数据清洗       │    Grafana面板            │
│ 数据归档        │  异常检测       │   自定义报表              │
│ 实时计算        │  趋势分析       │   预警仪表盘              │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       告警通知层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  告警规则        │  通知渠道        │     应急响应              │
│                 │                │                           │
│ 阈值设置        │  邮件通知       │   自动修复                │
│ 条件判断        │  短信提醒       │   人工干预                │
│ 分级告警        │  钉钉/微信      │   故障恢复                │
└─────────────────┴─────────────────┴───────────────────────────┘
```

## 安全架构设计

### 1. 多层次安全防护

```
┌─────────────────────────────────────────────────────────────────┐
│                       网络安全层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  DDoS防护        │  WAF防火墙      │     VPN访问               │
│                 │                │                           │
│  流量清洗        │  SQL注入防护    │   内网隔离                │
│  IP黑名单        │  XSS防护       │   加密传输                │
│  速率限制        │  CSRF防护      │   身份验证                │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       应用安全层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  代码安全        │  数据安全        │     访问控制              │
│                 │                │                           │
│  代码审查        │  数据加密       │   RBAC权限               │
│  安全依赖        │  数据脱敏       │   操作审计                │
│  漏洞扫描        │  备份恢复       │   会话管理                │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       数据安全层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  数据库安全      │  存储安全        │     传输安全              │
│                 │                │                           │
│  访问控制        │  加密存储       │   HTTPS加密              │
│  审计日志        │  权限分离       │   证书管理                │
│  数据备份        │  版本控制       │   密钥轮换                │
└─────────────────┴─────────────────┴───────────────────────────┘
```

## 性能优化架构

### 1. 前端性能优化策略

```
┌─────────────────────────────────────────────────────────────────┐
│                       加载性能优化                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  代码分割        │  资源压缩        │     缓存策略              │
│                 │                │                           │
│  路由懒加载      │  Gzip压缩       │   Service Worker         │
│  组件懒加载      │  Brotli压缩     │   HTTP缓存               │
│  第三方库按需    │  图片优化       │   CDN缓存                │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       运行时性能优化                              │
├─────────────────┬─────────────────┬───────────────────────────┤
│  虚拟化技术      │  内存管理        │     渲染优化              │
│                 │                │                           │
│  虚拟列表        │  垃圾回收       │   防抖节流               │
│  虚拟滚动        │  内存泄漏检测   │   请求合并               │
│  无限滚动        │  性能监控       │   异步加载               │
└─────────────────┴─────────────────┴───────────────────────────┘
```

### 2. 后端性能优化策略

```
┌─────────────────────────────────────────────────────────────────┐
│                       数据库优化                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  查询优化        │  索引优化        │     连接池优化            │
│                 │                │                           │
│  SQL优化        │  复合索引       │   连接复用               │
│  分页查询        │  覆盖索引       │   连接超时               │
│  预编译语句      │  索引统计       │   连接监控               │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       缓存策略优化                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  多级缓存        │  缓存失效        │     缓存预热              │
│                 │                │                           │
│  Redis缓存      │  时间过期       │   热点数据               │
│  本地缓存        │  主动失效       │   预加载                 │
│  CDN缓存        │  一致性哈希     │   缓存监控               │
└─────────────────┴─────────────────┴───────────────────────────┘
```

## 扩展性架构设计

### 1. 水平扩展架构

```
┌─────────────────────────────────────────────────────────────────┐
│                       负载均衡层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  流量分发        │  健康检查        │     会话保持              │
│                 │                │                           │
│  轮询策略        │  服务发现       │   Sticky Session         │
│  最小连接        │  故障转移       │   会话复制               │
│  哈希算法        │  自动扩容       │   无状态设计             │
└─────────────────┴─────────────────┴───────────────────────────┘
         │                │                │
         ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       服务实例层                                │
├─────────────────┬─────────────────┬───────────────────────────┤
│  前端实例        │  后端实例        │     数据库实例            │
│                 │                │                           │
│  多区域部署      │  容器化部署     │   读写分离               │
│  自动伸缩        │  微服务架构     │   分库分表               │
│  蓝绿部署        │  服务网格       │   数据分区               │
└─────────────────┴─────────────────┴───────────────────────────┘
```

---

**文档版本**: v1.0  
**创建日期**: 2025-11-11  
**最后更新**: 2025-11-11  
**架构负责人**: 开发团队